---
title: "å®Ÿå‹™ã§ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ¡ã‚½ãƒƒãƒ‰ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’é‹ç”¨ã—ã¦ã¿ãŸè©±"
emoji: "ğŸ—¯ï¸"
type: "tech"
topics:
  - "gof"
  - "designpattern"
published: true
published_at: "2023-11-23 17:47"
---

## å•é¡Œ

æœ€è¿‘ã®æ¥­å‹™ã§ã¯ã€ä½•ç¨®é¡ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œã«å¯¾ã—ã¦å±¥æ­´ãƒ‡ãƒ¼ã‚¿ã‚’è¨˜éŒ²ã™ã‚‹ãƒ‹ãƒ¼ã‚ºãŒã‚ã‚Šã¾ã—ãŸã€‚æ“ä½œã®ç¨®é¡ã«ã‚ˆã£ã¦é•ã†ãƒ‡ãƒ¼ã‚¿ãŒå¿…è¦ã‚‚ã®ã®ã€å…±é€šã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚‚ãŸãã•ã‚“å­˜åœ¨ã™ã‚‹ã¨ã„ã†çŠ¶æ³ã§ã™ã€‚DBãƒ¬ãƒ™ãƒ«ã§è¦‹ã‚‹ã¨ã€ã“ã®ã‚ˆã†ãªãƒ†ãƒ¼ãƒ–ãƒ«è¨­è¨ˆã§ã€è¦ã¯1->Nã®è¦ªãƒ†ãƒ¼ãƒ–ãƒ«ï¼‹å­ãƒ†ãƒ¼ãƒ–ãƒ«ã®å½¢ã¨ãªã‚Šã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/c54f3fe4a5ab-20231123.png)

ã“ã®DBã®è¨­è¨ˆã‚’ã‚³ãƒ¼ãƒ‰ä¸Šåæ˜ ã™ã‚‹ã¨ã€è‡ªç„¶ã«ã€Œç¶™æ‰¿ã€ã¨ã„ã†è¨€è‘‰ãŒå‡ºã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚å®Ÿéš›ã«ã»ã¼å…¨ã¦ã®æ“ä½œã§ã€è¦ªãƒ†ãƒ¼ãƒ–ãƒ«ã¨ã®ã‚¸ãƒ§ã‚¤ãƒ³ãŒå¿…è¦ãªã®ã§ã€å¼·ä¾å­˜ã«ã¯ãªã‚‹ã‚‚ã®ã®ã€ç¶™æ‰¿ã§å•é¡Œãªã„ã¨è€ƒãˆã¦ã„ã¾ã—ãŸã€‚

ãã‚Œã§ã€DBã‚¢ã‚¯ã‚»ã‚¹ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ã—ã¦ã€ãƒ¬ãƒã‚¸ãƒˆãƒªãƒ¼ã‚’å°å…¥ã—ã¦ã„ã¾ã—ãŸã€‚å…±é€šã™ã‚‹éƒ¨åˆ†ã®æ“ä½œãŒã‚ã‚‹ã®ã§ã€ç¹°ã‚Šè¿”ã—ã®å®šç¾©ã‚’ã•ã‘ã‚‹ãŸã‚ã«ã‚‚ã€è¦ªã‚¯ãƒ©ã‚¹ã®ã¨ã“ã‚ã§CRUDã®APIãªã©ã‚’å®Ÿè£…ã—ã¦ã¿ã‚ˆã†ã¨æ€ã„ã¾ã—ãŸã€‚ã—ã‹ã—ã€ã‚„ã£ã¦ã¿ã‚‹ã¨ã„ãã¤ã‹å•é¡Œã¨ã‚ã‚Šã¾ã—ãŸã€‚

## ç´ æœ´ãªç¶™æ‰¿

ã¾ãšã€å…¨ã¦ã®repositoryã«ç¶™æ‰¿ã•ã›ã‚‹ãŸã‚ã®ã€ãƒ™ãƒ¼ã‚¹ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã¯æ“ä½œå±¥æ­´ã«é™ã‚‰ãšã€å…¨ã¦ã®repositoryã«ä½¿ãˆã¾ã™ã€‚

```ts
// use Knex for example
export default class BaseRepository {
  protected trxProvider: Knex.TransactionProvider;
  constructor(
    protected db: Knex,
    protected logger: Logger = getDefaultLogger(),
  ) {
    this.trxProvider = this.db.transactionProvider();
  }
}
```

æ¬¡ã«ã€å±¥æ­´ã®è¦ªã‚¯ãƒ©ã‚¹ã‚’å®Ÿè£…ã€‚

```ts
class OperationHistoryRepository extends BaseRepository {
  constructor(db: Knex) {
    super(db);
  }

  async create(data: Record<string, unknown>): Promise<void> {...}
  async update(data: Partial<Record<string, unknown>>): Promise<void> {...}
  async deleteById(historyId: number): Promise<void> {...}
  async getById(historyId: number): Promise<Record<string, unknown>> {...}
}
```

ã“ã‚Œã‚’å­ã‚¯ãƒ©ã‚¹ã«ç¶™æ‰¿ã•ã›ã‚‹ã¨ã€

```ts
class OperationHistoryA extends OperationHistoryRepository {
  private tableName = tables.operationHistoryA.name;
  private operationType = "operation_a";
}
```

ã“ã“ã§2ã¤ã®å•é¡ŒãŒã‚ã‚Šã¾ã™ã€‚

- è¦ªã«å…±é€šæ“ä½œã‚’æŒãŸã›ã¦ã„ã‚‹ãŒã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã‚‚ãƒªã‚¿ãƒ¼ãƒ³å€¤ã‚‚ã‚¿ã‚¤ãƒ—ãŒã‚ã‹ã‚‰ãªã„
- å­ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã¨è¦ªã®ãƒ†ãƒ¼ãƒ–ãƒ«ã®æ“ä½œãŒåŒæ™‚ã«å¿…è¦ãªæ™‚ã«ã€å­ãƒ†ãƒ¼ãƒ–ãƒ«ã®æƒ…å ±ã‚’æŒã£ã¦ã„ãªã„

## ã‚¸ã‚§ãƒãƒªãƒƒã‚¯ã‚¿ã‚¤ãƒ—

ã¾ãšä¸€å€‹ç›®ã®å•é¡Œã‚’å¯¾å‡¦ã™ã‚‹ãŸã‚ã«ã€å­ã‚¯ãƒ©ã‚¹ã®ã‚¿ã‚¤ãƒ—ã‚’ã€ã‚¸ã‚§ãƒãƒªãƒƒã‚¯ã‚¿ã‚¤ãƒ—ã¨ã—ã¦è¦ªã‚¯ãƒ©ã‚¹ã«å¼•ãæ¸¡ã—ã¾ã™ã€‚

```ts
type OperationHistory = {...}

type OperationHistoryA = {...}
type OperationHistoryB = {...}
type OperationHistoryC = {...}

type OperationHistoryChild =
  | OperationHistoryA
  | OperationHistoryB
  | OperationHistoryC;

class OperationHistoryRepository<T extends OperationHistoryChild> extends BaseRepository {
  async create(data: Omit<T, 'history_id'>): Promise<void> {...}
  async update(data: Partial<Omit<T, 'history_id'>>): Promise<void> {...}
  async deleteById(historyId: number): Promise<void> {...}
  async getById(historyId: number): Promise<T & OperationHistory> {...}
}


class OperationHistoryA extends OperationHistoryRepository<OperationHistoryA> {...}

```

ãƒ†ãƒ¼ãƒ–ãƒ«ã‚¸ãƒ§ã‚¤ãƒ³å¾Œã®ã‚¿ã‚¤ãƒ—ã‚’æ­£ã—ãä¼ãˆã‚‹ãŸã‚ã«ã€`T & OperationHistory`ã§å¾—ã‚‰ã‚Œã¾ã™ã€‚

ã“ã‚Œã§ã€è¦ªã‚¯ãƒ©ã‚¹ã«å…±é€šãƒ¡ã‚½ãƒƒãƒ‰ã‚’æŒãŸã›ã¦ã‚‚OKã«ãªã‚Šã¾ã™ã€‚ã‚¿ã‚¤ãƒ—ãŒã‚ã‹ã‚‹ã¨å¤§ããªä¸€æ­©ã§ã—ãŸã€‚

## ã‚¢ãƒ–ã‚¹ãƒˆãƒ©ã‚¯ãƒˆã‚¯ãƒ©ã‚¹

ã“ã“ã§å®Ÿã¯ã‚‚ã†ä¸€ã¤å•é¡ŒãŒã‚ã‚Šã¾ã™ã€‚ã¨ã„ã†ã®ã¯ã€è¦ªã‚¯ãƒ©ã‚¹ã¯ã‚ãã¾ã§ã‚‚å…±é€šæƒ…å ±ã‚’æŒã¤ãŸã‚ã«å­˜åœ¨ã—ã€å®Ÿéš›ã«å˜ç‹¬ã§è¦ªã‚¯ãƒ©ã‚¹ã‚’ä½¿ã†ã“ã¨ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ãªãœãªã‚‰ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œã«ã¯A,B,Cã¨ã„ã£ãŸç¨®é¡ã—ã‹ãªãã€Parentã¨ã„ã†ã‚ˆã†ãªç¨®é¡ãŒãªã„ã‹ã‚‰ã§ã™ã€‚ã“ã®å ´åˆã€è¦ªã‚¯ãƒ©ã‚¹ã‚’æŠ½è±¡åŒ–ã—ã¦ã€[ã‚¢ãƒ–ã‚¹ãƒˆãƒ©ã‚¯ãƒˆã‚¯ãƒ©ã‚¹](https://typescriptbook.jp/reference/object-oriented/class/abstract-class) ã«å®šç¾©ã™ã‚‹ã¨è‰¯ã„ã§ã—ã‚‡ã†ã€‚

```ts
abstract class OperationHistoryRepository<
  T extends OperationHistoryChild,
> extends BaseRepository {
  constructor(db: Knex) {
    super(db);
    if (this.constructor === OperationHistoryRepository) {
      throw new Error("Cannot instantiate an abstract class.");
    }
  }
}
```

ãªãŠã€JSã«ã¯ã‚¢ãƒ–ã‚¹ãƒˆãƒ©ã‚¯ãƒˆã‚¯ãƒ©ã‚¹ãŒãªã„ãŸã‚ã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«å¾Œã¯æ™®é€šã®ã‚¯ãƒ©ã‚¹ã¨ã—ã¦ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–å¯èƒ½ã§ã™ã€‚ãã‚Œã‚‚é˜²æ­¢ã—ãŸã„ã®ã§ã€ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ãƒ¼é–¢æ•°ã§ã¯ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã¦ã„ã¾ã™ã€‚

## ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ¡ã‚½ãƒƒãƒ‰ãƒ‘ã‚¿ãƒ¼ãƒ³

ã“ã‚Œã¾ã§ã«ã‚¿ã‚¤ãƒ—ã®å•é¡ŒãŒè§£æ±ºã§ããŸãŒã€ã‚‚ã†ä¸€ã¤ã®å•é¡Œã¨ã—ã¦ã€å­ã‚¯ãƒ©ã‚¹ãƒ†ãƒ¼ãƒ–ãƒ«åã¨ã„ã£ãŸæƒ…å ±ãŒã‚ã‹ã‚Šã¾ã›ã‚“ã€‚ãªãœå¿…è¦ã‹ã¨ã„ã†ã¨ã€

- createã¨ã®æ“ä½œã®æ™‚ã«ã€ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã§è¦ªãƒ†ãƒ¼ãƒ–ãƒ«ã¨å­ãƒ†ãƒ¼ãƒ–ãƒ«ã¸åŒæ™‚ã«ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’æŒ¿å…¥ã—ãŸã„
- getæ“ä½œã®æ™‚ã«ã€è¦ªå­ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã®ã‚¸ãƒ§ã‚¤ãƒ³ãŒå¿…è¦ã§ã€å­ãƒ†ãƒ¼ãƒ–ãƒ«åãŒå¿…è¦
- å–å¾—ãƒ‡ãƒ¼ã‚¿ã«å¯¾ã—ã¦ã€repositoryã®è²¬å‹™ã¨ã—ã¦ã‚¹ã‚­ãƒ¼ãƒãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã¦ã„ã‚‹ãŒã€ãã®ã‚¹ã‚­ãƒ¼ãƒæƒ…å ±ãŒã‚ã‹ã‚‰ãªã„ã¨ã‚¬ãƒ¼ãƒ‰ãŒã§ããªããªã‚‹

ã“ã®ã‚ˆã†ãªã€**è¦ªã§å…±é€šæ“ä½œã‚’å®šç¾©ã—ã¦ã„ã‚‹ä¸­ã§ã€ä¸€éƒ¨ã®æƒ…å ±ãŒå­ã®æ–¹ã«å­˜åœ¨ã—ã€ãã‚Œã‚’å–ã‚‰ãªã„ã¨è¡Œã‹ãªã„**ã€ã¨ã„ã†å ´é¢ã ã¨ã€ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ¡ã‚½ãƒƒãƒ‰ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ç™»å ´ã§ã™ã€‚

ãƒã‚¤ãƒ³ãƒˆã¨ã—ã¦ã€å­ã‚¯ãƒ©ã‚¹ã‹ã‚‰æƒ…å ±ã‚’å–ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã¯ã€ã‚¢ãƒ–ã‚¹ãƒˆãƒ©ã‚¯ãƒˆãƒ¡ã‚½ãƒƒãƒ‰ã¨ã—ã¦å®šç¾©ã™ã‚‹ã“ã¨ã§ã™ã€‚ãªãœãªã‚‰ã€

- ã‚·ã‚°ãƒãƒãƒ£ãƒ¼ã ã‘ã‚’æ®‹ã—ã€å®Ÿè£…ã¯å­ã‚¯ãƒ©ã‚¹ã«ä»»ã›ã‚‰ã‚Œã‚‹
- ã‚¢ãƒ–ã‚¹ãƒˆãƒ©ã‚¯ãƒˆãƒ¡ã‚½ãƒƒãƒ‰ã¯ã€ç¶™æ‰¿æ™‚ã«å¿…ãšå®Ÿè£…ã‚’ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„åˆ¶ç´„ã§ã‚‚ã‚ã‚‹

```ts
abstract class OperationHistoryRepository<
  T extends OperationHistoryChild,
> extends BaseRepository {
  constructor(db: Knex) {
    super(db);
    if (this.constructor === OperationHistoryRepository) {
      throw new Error("Cannot instantiate an abstract class.");
    }
  }

  protected abstract getChildOperationType(): OperationHistoryType;
  protected abstract getChildOperationTableName(): OperationHistoryTableName;

  public async create({
    userId,
    data,
  }: {
    userId: string;
    data: ChildInsertData<T>;
  }) {
    // äºŒã¤ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã«æŒ¿å…¥ãŒå¿…è¦ãªã®ã§ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å¿…è¦
    const trx = await this.trxProvider();
    try {
      const historyId = await this.insertParentTable(trx, userId);
      await this.insertChildTable(trx, historyId, data);
      await trx.commit();
      return historyId;
    } catch (error: unknown) {
      await trx.rollback();
      throw error;
    }
  }

  private async insertParentTable(trx: Knex.Transaction, userId: string) {
    // ã“ã“ã§å­ã‚¯ãƒ©ã‚¹ã‹ã‚‰æ“ä½œã®ç¨®é¡ã‚’å–å¾—
    const type = this.getChildOperationType();
    const [inserted] = await trx.table(this.parentTableName).insert(
        {
          user_id: userId,
          created_at: trx.fn.now(),
          operation_type: type,
          state: "pending",
        },
        "*",
      );
    if (inserted == null) throw new Error("Failed");
    return inserted.history_id;
  }

  private insertChildTable(
    trx: Knex.Transaction,
    historyId: number,
    childData: ChildInsertData<T>,
  ) {
    // ã“ã“ã§å­ã‚¯ãƒ©ã‚¹ã‹ã‚‰ãƒ†ãƒ¼ãƒ–ãƒ«åã‚’å–å¾—
    const childTable = this.getChildOperationTableName();
    return trx
      .table(childTable)
      .insert({ ...childData, [this.parentTableFields.id]: historyId });
  }

  public async getById(
    historyId: number,
  ): Promise<(T & OperationHistory) | null | undefined> {
    // ã“ã“ã§å­ã‚¯ãƒ©ã‚¹ã‹ã‚‰ãƒ†ãƒ¼ãƒ–ãƒ«åã‚’å–å¾—
    const childTable = this.getChildOperationTableName();
    const row = await this.db
      .table(childTable)
      .select(["*"])
      .leftJoin(
        this.parentTableName,
        `${childTable}.${this.primaryKey}`,
        `${this.parentTableName}.${this.primaryKey}`,
      )
      .where({
        [`${childTable}.${this.primaryKey}`]: historyId,
      })
      .first();
    return row;
  }
}
```

å­ã‚¯ãƒ©ã‚¹ã§ã¯ã€å®šç¾©ã•ã‚Œã¦ã„ã‚‹ã‚¢ãƒ–ã‚¹ãƒˆãƒ©ã‚¯ãƒˆãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè£…ã™ã‚Œã°å®Œæˆã€‚

```ts
class OperationHistoryA extends OperationHistoryRepository {
  private tableName = "operation_a_table";
  private operationType = "operation_a";

  protected getChildOperationType() {
    return this.operationType;
  }

  protected getChildOperationTableName() {
    return this.tableName;
  }
}
```


## ã‚¹ã‚­ãƒ¼ãƒãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

å‰ç¯€ã§è§¦ã‚Œã¦ã„ã¾ã—ãŸãŒã€ãƒ†ãƒ¼ãƒ–ãƒ«åãªã©ä»¥å¤–ã«ã‚‚ã€ã‚¹ã‚­ãƒ¼ãƒå®šç¾©ã‚’å–å¾—ã—ãŸã„ã®ã§ã™ã€‚

ã‚¹ã‚­ãƒ¼ãƒã®å®šç¾©ã¨ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€[zod](https://zod.dev/)ã‚’ä¾‹ã«ã—ã¾ã™ã€‚

```ts

const zOperationHistory = z.object({
  historyId: z.number(),
  createdAt: z.string().datetime(),
  finishedAt: z.Astring().datetime().nullish(),
  state: z.enum([...]),
})
type OperationHistory = z.infer<typeof zOperationHistory>

const zOperationHistoryA = zOperationHistory.extend({...})
type OperationHistoryA = z.infer<typeof zOperationHistoryA>

```

ã“ã‚Œã§ã‚¹ã‚­ãƒ¼ãƒã‚’å–å¾—ã™ã‚‹ãŸã‚ã«ä¸€å€‹ãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```ts
  protected abstract getChildOperationSchema(): z.ZodSchema<T>;
```

ã™ã‚‹ã¨ã€getã¨ã‹ã®æ™‚ã«å–å¾—ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã«å¯¾ã—ã¦ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã‹ã‘ã‚‰ã‚Œã¾ã™ã€‚

```ts
  private async getSchema() {
    const childSchema = this.getChildOperationSchema();
    return z.intersection(zOperationHistory, childSchema);
  }

  public async getById(
    historyId: number,
  ): Promise<(T & OperationHistory) | null | undefined> {
    const childTable = this.getChildOperationTableName();
    const zRow = this.getSchema();
    const row = zRow.nullish().parse(
      await this.db
        .table(childTable)
        .select(["*"])
        .leftJoin(
          ...
        )
        .where({
	  ...
        })
        .first(),
    );
    return row;
  }

  // nullishã®å€¤ã‚’é™¤å¤–ã—ãŸã„å ´åˆã¯Laravelã«å› ã‚“ã§orFailç³»ã‚‚è€ƒãˆã‚‰ã‚Œã‚‹
  public async getOrFail(historyId: number): Promise<T & OperationHistory> {
    const row = await this.getById(historyId);
    if (row == null) {
      throw new Error(`History ${historyId} does not exist`);
    }
    return row;
  }

  public async list(userId: string): Promise<Array<T & OperationHistory>> {
    const zRow = this.getSchema();
    const rows = zRow.array().parse(...);
    return rows;
  }
```

## è€ƒãˆ

ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ã‚ãªã‘ã‚Œã°ãªã‚‰ãªã„ã®ã‹ã€ã¨è¨€ã‚ã‚Œã‚‹ã¨ã€ãã†ã§ã‚‚ãªã„ã®ã§ã™ã€‚è¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å…¨éƒ¨å–ã‚Šé™¤ãã¨ã€å¤§ä½“ã¯`if/else`ã®åˆ†å²ã«é›†ç´„ã§ãã¾ã™ã€‚ä¾‹ãˆã°ã€ã‚¹ã‚­ãƒ¼ãƒã®å–å¾—ã ã¨æ¬¡ã«ãªã‚Šã¾ã™ã€‚

```ts
  private getChildOperationSchema(): z.ZodSchema<T> {
    const operationType = this.getChildOperationType();
    return match(operationType)
      .with("operation_a", () => {
        return zOperationHistoryA as unknown as z.ZodSchema<T>;
      })
      .with("operation_b", () => {
        return zOperationHistoryB as unknown as z.ZodSchema<T>;
      })
      .with("operation_c", () => {
        return zOperationHistoryC as unknown as z.ZodSchema<T>;
      })
      .exhaustive();
  }
```

ã“ã®ã‚„ã‚Šæ–¹ãŒæ‚ªã„ã®ã‹ï¼Ÿãã†ã§ã‚‚ãªã„æ°—ã‚‚ã—ã¾ã™ã€‚enumç³»ã®å€¤ã«å¯¾ã—ã¦ã€ãã¡ã‚“ã¨exhaustiveã¾ã§å®Ÿè£…ã—ã¦ã„ã‘ã°ã€ä¸€èˆ¬çš„ãª`else`å•é¡Œï¼ˆã‚±ãƒ¼ã‚¹ã‚’è¿½åŠ ã™ã‚‹éš›ã«åˆ†å²ãŒè¿½åŠ ã•ã‚Œã¦ã„ãªãã€çµå±€elseã«è½ã¡ã‚‹å•é¡Œï¼‰ã‚’å®Œå…¨ã«é¿ã‘ã‚‰ã‚Œã¾ã™ã€‚

ãªã‚‰ãªãœãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ¡ã‚½ãƒƒãƒ‰ãŒè‰¯ã„ã®ã‹ã€‚**SOLIDã ã‹ã‚‰**ã ã¨è€ƒãˆã¦ã„ã¾ã™ã€‚

- **å˜ä¸€è²¬ä»»åŸå‰‡(SRP)** aã®ã‚‚ã®ã¯aã§ã€bã®ã‚‚ã®ã¯bã§é›†ç´„ã™ã‚‹å½¢ã«ãªã‚Šã¾ã™ã€‚
- **ã‚ªãƒ¼ãƒ—ãƒ³ã‚¯ãƒ­ãƒ¼ã‚ºåŸå‰‡(OCP)** æ‹¡å¼µã«ã¯é–‹æ”¾çš„ã§ã‚ã‚ŠãªãŒã‚‰ã€å¤‰æ›´ã«ã¯é–‰é–çš„ã€ã¨ã®ã“ã¨ã§ã™ã€‚åˆ†å²ã§å®Ÿè£…ã™ã‚‹ã¨ã€ä»Šåº¦æ“ä½œã‚¿ã‚¤ãƒ—DãŒå‡ºãŸã‚‰ã€`getChildOperationSchema`ã®å®Ÿè£…ã«å¯¾ã—ã¦ã€å¤‰æ›´ã‚’è¡Œã‚ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ã€‚exhaustiveã«ã—ã¦ã„ã‚‹ãªã‚‰ã¾ã ã—ã‚‚ã€`else`å•é¡Œã«è½ã¡ã„ã‚‹å¯èƒ½æ€§ã‚‚ã‚ã‚Šã¾ã™ã€‚ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ¡ã‚½ãƒƒãƒ‰ã§ã‚„ã‚‹ã¨ã€ã‚¢ãƒ–ã‚¹ãƒˆãƒ©ã‚¯ãƒˆãƒ¡ã‚½ãƒƒãƒ‰ã¯å¿…ãšå®Ÿè£…ã—ãªã„ã¨ã„ã‘ãªã„ã®ã§ã€çµ¶å¯¾ã«ã“ã®çŠ¶æ³ã¯é¿ã‘ã‚‰ã‚Œã‚‹ã¨ã‚‚è¨€ãˆã¾ã™ã€‚
- **ãƒªã‚¹ã‚³ãƒ•ç½®ãæ›ãˆåŸå‰‡(LSP)** å­ã‚¯ãƒ©ã‚¹ã¯ã€è¦ªã‚¯ãƒ©ã‚¹ã«å…¥ã‚Œæ›¿ãˆã‚‰ã‚Œã‚‹ã€‚ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å‘ã‘ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã§ã™ã­ã€‚
- **ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹åˆ†é›¢åŸå‰‡(ISP)** ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ¡ã‚½ãƒƒãƒ‰ã§ã¯ã€ã‚¢ãƒ–ã‚¹ãƒˆãƒ©ã‚¯ãƒˆãƒ¡ã‚½ãƒƒãƒ‰ã®å®šç¾©ã‚’å‹§ã‚ã‚‹ã®ã§ã€å‰²ã¨ã‚·ãƒ³ãƒ—ãƒ«ãªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼ˆãƒ¡ã‚½ãƒƒãƒ‰ï¼‰ã«ãªã‚Šã‚„ã™ã„ã§ã™ã€‚ä»–ã®åŸå‰‡ã¨ã‚‚çµ¡ã‚“ã§ã„ã‚‹ã®ã§ã™ãŒã€ã“ã‚Œã¯å®Ÿéš›åœ°å‘³ã«ã‚ã‚ŠãŒãŸã„ã§ã™ã­ã€‚ä¾‹ãˆã°ã€ä»Šå›ã®ä¾‹ã§ã¯æ“ä½œã®ã‚¿ã‚¤ãƒ—ã€ãƒ†ãƒ¼ãƒ–ãƒ«åã€ã‚¹ã‚­ãƒ¼ãƒã«å¯¾ã—ã¦ãã‚Œãã‚Œæ¥µã‚·ãƒ³ãƒ—ãƒ«ãªAPIãŒã§ãã¦ã„ã¾ã™ã€‚è¨­è¨ˆã™ã‚‹æ™‚ã«ä½™è¨ˆã«è¤‡é›‘ãªä¸­èº«ã‚’è€ƒãˆã‚‹ã“ã¨ãŒã€æŠ‘ãˆã‚‰ã‚Œã„ã‚‹ã®ã§ã¯ãªã„ã‹ã¨æ€ã„ã¾ã™ã­ã€‚
- **ä¾å­˜åè»¢åŸå‰‡(DIP)** æ„Ÿå‹•ãŒæ­¢ã¾ã‚‰ãªã„åŸå‰‡ã€‚è¦ªã¯å­ã‚¯ãƒ©ã‚¹ã®å®Ÿè£…ã«ä¾å­˜ã›ãšã€ãã®æŠ½è±¡ã ã‘ã‚’ä¾å­˜ã™ã‚‹ã€‚å­ã‚¯ãƒ©ã‚¹ã‚‚ã€ãã®æŠ½è±¡åŒ–ã•ã‚ŒãŸãƒ¡ã‚½ãƒƒãƒ‰ã®ã‚·ã‚°ãƒãƒãƒ£ãƒ¼ã«æ²¿ã£ã¦å®Ÿè£…ã™ã‚Œã°OKã€‚è¦ªå­ã¯ãŠäº’ã„ã¸ã®ä¾å­˜ã¯ãªãã€æŠ½è±¡å®šç¾©ã«ä¾å­˜ã™ã‚‹ã“ã¨ã«ã€‚

ã¨ã„ã†ã“ã¨ã§ã€ä»Šå›ã¯å®Ÿè·µä¸­ã®è¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³ã€ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ¡ã‚½ãƒƒãƒ‰ã«ã¤ã„ã¦æ›¸ã„ã¦ã¿ã¾ã—ãŸã€‚éå¸¸ã«å¼·åŠ›ã§ã‚¨ãƒ¬ã‚¬ãƒ³ãƒˆã§ç¾ã—ã„ãƒ‘ã‚¿ãƒ¼ãƒ³ãªã®ã§ã€ä»Šå¾Œã‚‚æœ«é•·ãä»˜ãåˆã£ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ï¼ˆç¬‘ï¼‰ã€‚
