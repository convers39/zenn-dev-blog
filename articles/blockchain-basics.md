
# WHAT

## 分散型システムの観点

そもそも今回の記事に執筆する経緯として、分散型システムの本を読んでいる中で、gossip protocolというものを知り、それでBitcoinにも使われているよ、との情報が得られて興味を持ち始めました。ブロックチェーンは元々根幹的分散型システムなので、この節では従来のWEB2で議論しているものとの違いをみながら、ブロックチェーンの特徴や考え方を紹介したいと思います。

### CAP定理とPACELセオレム

分散型システムの設計において、CAP定理（Consistency, Availability, Partition Tolerance）は重要な指針となりますが、ブロックチェーンの場合、特に「Partition Tolerance（ネットワーク分断に対する耐性）」が前提条件とされます。そのため、Consistency（整合性）とAvailability（可用性）のトレードオフが課題となります。

PACELセオレムは、Performance（性能）、Availability（可用性）、Consistency（整合性）、Ease of use（使いやすさ）、Latency（遅延）の観点から分散システムを捉え直すフレームワークです。ブロックチェーン技術においては、特に性能（Performance）と遅延（Latency）の最適化が課題です。また、ネットワークパーティションの有無に関わらず、ブロックチェーンの場合は常に整合性と遅延のトレードオフが存在します。

### 分散型 vs 脱中央集権型

脱中心化という言葉はよく聞きますが、厳密に従来の分散型システムとは多少イメージが違います。

「分散型（Distributed）」と「脱中心型（Decentralized）」は似て非なる概念です。従来の分散型システム（例：クラウドサービス）では、ノードが協調して中央集約的な制御を実現します。一方、ブロックチェーンでは、ノード間の信頼が不要で、各ノードが独立して動作することを重視します。この違いが、従来の分散型システムとは異なるユースケースを生み出しています。

### 分散型システムのコンセンサスアルゴリズム

分散型システム内の複数のノードが整合性の取れた状態を維持するために、一つのルール（アルゴリズム）を決める必要があります。従来の分散型システムとブロックチェーンでは求められる要件や適用方法に違いがあり、それに応じて採用されるアルゴリズムも異なります。

従来の分散型システムでは、Paxos(multi-paxosなど派生も含め)、Raft、BFT(Byzantine Fault Tolerance)などのアルゴリズムが挙げられます。Kubernetesのバックエンドetcd、ではRaft, Cockroach DB, Google Spanner、CassandraなどではPaxosを採用しています。これらのアルゴリズムは総じて、CFT(crash fault Tolerance)アルゴリズムとして考えられます。

一方で、ブロックチェーンの分散型システムでは、各ノードにおいて信頼関係はないし、設計上スループットも結構ネックになるので、考慮する要素が違います。ブロックチェーンの方ではPBFT(Practical Byzantine Fault Tolerance)、PoW(Proof of Work), PoS(Proof of Stake)などのアルゴリズムが挙げられます。これらは何方かと言えば、C(rash)に関心があるというより、B(yzantine)に関心が強いため、データの整合性やデータ改竄などに非常に強いことから、BFT(Byzantine Fault Tolerance)アルゴリズムとされています。

ブロックチェーンのアーキテクチャのところで、どのように整合性を保つか、データ改竄に強いかを見ていきたいと思います。


## 特徴

- P2P（ピアツーピア）
中央サーバーを持たず、ノード同士が直接通信することでシステムを維持。BitTorrentやNapsterと似た仕組み。
- 分散型台帳/帳簿（Distributed Ledger） 各ノードが台帳を共有し、取引履歴を同期。データの改ざんが極めて難しくなる。
- 暗号学的セキュリティ（Cryptographically Secure） トランザクションの検証やデータ保護に暗号技術（例：ハッシュ関数や公開鍵暗号）が使われ、データの完全性が保証される。
- 追加のみ可能（Append-Only） 過去のデータを改変することはできず、新たなデータのみ追加可能。これが信頼性の基盤。
- コンセンサスによる更新（Updatable via Consensus） PoW（Proof of Work）やPoS（Proof of Stake）などのアルゴリズムにより、ネットワーク全体の合意を取って更新。

## 解決している問題とは

ブロックチェーンの技術でどのような問題を解決しようとするかというと、やはりその特徴からざっくり言えばこれらが挙げられるかと

- 信頼性の確保、または第三者を介さずに信頼を構築。この場合は金融取引の中間業者（銀行とか）が不要になります。
- データ改ざん防止、過去の取引を変更するにはネットワーク全体（全てのノード）を攻撃する必要があり、ほぼ不可能になります（ただ例外として半数以上のノードを取ると51%攻撃ができます）。
- 透明性の向上、誰でも公開帳簿を確認可能になります。よくあるドネーションの資金流れが不明とか、政府の資金流れが不透明などの問題が解消できるかと（まあ別問題でこれは進められない可能性がありますが）。

## 問題点

一方で、ブロックチェーンにはそれなりに課題を抱えています。

- スケーラビリティ（Scalability）ビットコインは1秒間に約7トランザクションのみ。従来のDBのように大量データ処理がかなり厳しい。
- 規制の不確実性（Regulation） 各国の態度も違うし、色々と政策面で規制が難しい（元々それと対抗するような一面もあるかもですが）
- プライバシー（Privacy） トランザクションが公開されるため、匿名性が不完全（結局身分証明提出しないと使えないとか仮想通貨取引所の規制がほとんどだし、今後も国際的に規制が増える予想がつくので、完全な匿名性は求められないかなと）。
- 技術の未成熟（Immature Technology）まだまだ若い技術なので言葉通りかなと。
- 相互運用性（Interoperability） これは2つの意味があって、一つは従来のweb2のネットワークとの連携、もう一つは異なるブロックチェーン間の連携が難しいことです。
- エネルギー消費 これは主に、仮想通貨を新しいブロックのマイニング報酬として位置づけられ、結局大きな電力をマイニングに使われてしまう問題です。Bitcoinのマイニングに使われる年間電力は国の年間発電量レベルになるらしいです。ただこれらの電力消費に対して十分な社会的な価値を貢献しているかは、よく疑問視されています（もちろん、ブロックチェーン＝仮想通貨ではない）。

技術者の観点からでは、スケーラビリティ、相互運用性周りはやはり気にしますね。これらの課題を解決するためにはすでに色々と試行錯誤が始まっています。

# blockchainシステムの仕組み

https://andersbrownworth.com/blockchain/

## アーキテクチャ

### レイヤー

ブロックチェーンのネットワークはいくつかレイヤーに分けられます。

- ネットワークレイヤー P2P通信の管理（例：ノード検出、データ転送）。
- データレイヤー トランザクションやブロックデータの保存。
- コンセンサスレイヤー PoWやPoSなどのアルゴリズムによる合意形成。
- アプリケーションレイヤー DApps（分散型アプリケーション）やスマートコントラクトの実行。

### block構成

### chain

### distributed

### 仮想通貨の取引所

### web3財布

## 動き方

### トランザクション

データ更新する際に、ノードの間にその更新を伝播させるためにgossip protocolを利用しています。この点に関しては従来の分散型システムとは大きく変わりはありません。一方で、

### マイニング

PoWなど





