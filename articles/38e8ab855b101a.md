---
title: "JSåŸºç¤ã„ã‚ã„ã‚ãƒ¼å‹å¼·åˆ¶(type coercion)"
emoji: "ğŸš€"
type: "tech"
topics:
  - "js"
  - "type"
  - "coercion"
published: true
published_at: "2023-01-29 01:01"
---

## çµŒç·¯

ä»Šå›ã®è©±ã«ã—ãŸç†ç”±ã¨ã„ã†ã®ã¯ã€å…ˆæ—¥ç¤¾å†…ã«èµ·ã“ã£ãŸä¼šè©±ã§ã—ãŸã€‚ã¨ã‚ã‚‹ç¤¾å“¡ã®ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã®sã‚­ãƒ¼ãŒæ•…éšœæ°—å‘³ã«ãªã£ã¦ã„ã¦ã€ãã‚Œã§ã€Œsã‚­ãƒ¼ã‚’ãŠã•ãšã«sã‚’å‡ºåŠ›ã™ã‚‹é¸æ‰‹æ¨©ã€ãŒé–‹å‚¬ã€‚ã¨ã‚ã‚‹å›ç­”ã¯ä»¥ä¸‹ã¨ãªã‚Šã¾ã™ã€‚

```js
(typeof({}+''))[+[]] // s
```

ã“ã‚Œã‚’è¦‹ãŸç¬é–“ã€ã€Œã“ã®ç™ºæƒ³ã«è„±å¸½ã€ã¨æ€ã„ã¾ã—ãŸã€‚ãã‚Œã§ã€ã›ã£ã‹ããªã®ã§è‡ªåˆ†ã®å¾©ç¿’ã‚’å…¼ã­ã¦ã€JSåŸºç¤ã‚·ãƒªãƒ¼ã‚ºã«ã‚‚æ›¸ã„ã¦ã¿ã‚ˆã†ã¨ã€ä»Šå›ã®è¨˜äº‹ã«è‡³ã‚Šã¾ã—ãŸã€‚

### ä½•ãŒèµ·ã“ã£ã¦ã„ã‚‹ã®ã‹

Kyle Simpsonæ°ãŒè‡ªåˆ†ã®ã‚·ãƒªãƒ¼ã‚ºä½œã€[You Don't Know JS Yet](https://github.com/getify/You-Dont-Know-JS)ã§ä¸»å¼µã—ã¦ã„ã‚‹ã€JSã¨è¨€ã†è¨€èªã‚’ç†è§£ã™ã‚‹ãŸã‚ã«å¿…è¦ãªä¸‰æœ¬æŸ±ã®ä¸€ã¤ã¨ãªã£ã¦ã„ã‚‹ã®ãŒã€**Types and Coercion**ã§ã™(ã¡ãªã¿ã«å¾ŒäºŒã¤ã¯prototypes, scope & closureã§ã™)ã€‚

ã“ã®å¼·åˆ¶å¤‰æ›ã®ä»•çµ„ã¿ãŒéå¸¸ã«ç…©ã‚ã—ãã€åˆå¿ƒè€…ãŒã‚ˆããƒãƒã£ã¦ã—ã¾ã†ã¨ã“ã‚ã§ã‚‚ã‚ã‚Šã¾ã™ã€‚è¨€èªè¨­è¨ˆä¸Šã®ãƒˆãƒ¬ã‚¤ãƒ‰ã‚ªãƒ•ã‚‚ã‚ã‚ŠãªãŒã‚‰ã€ã“ã®ä»•æ§˜ã¯ã€Œå®‰å…¨æ€§ã€ã‚’å¼•ãæ›ãˆã«ã€ã€Œåˆ©ä¾¿æ€§ã€ã¨ã€Œå±é™ºæ€§ã€ã‚’åŒæ™‚ã«ã‚‚ãŸã‚‰ã—ã¦ã„ã¾ã™ã€‚ã€ŒJSã¯ä½¿ã£ã¦ã‹ã‚‰å­¦ã¶ã€ã¨ã„ã†ä¸»å¼µã‚’ã—ãŸã‚Šã™ã‚‹äººã‚‚ã„ã¦ã€ã“ã®ä»•æ§˜ã¯éå¸¸ã«è»½è¦–ã•ã‚Œã‚„ã™ã„éƒ¨åˆ†ã§ã™ã€‚ãŸã è¨€èªä»•æ§˜ã¸ã®ç†è§£ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ãŸã‚ã«ã€ã“ã®è¾ºã‚Šã®å•é¡Œã¯é¢æ¥ã«ã‹ãªã‚Šå‘ã„ã¦ã„ã¾ã™ã®ã§ã€ãã†ã„ã£ãŸæ„å‘³ã§ã‚‚å­¦ã‚“ã§æã¯ãªã„ã¨æ€ã„ã¾ã™ã€‚

JSã¯å‹•çš„è¨€èªã§ã€ã‚¿ã‚¤ãƒ—ã«é–¢é€£ã™ã‚‹ãƒã‚§ãƒƒã‚¯ã¯ã»ã¼ãªãæ„Ÿã˜ã¾ã™ãŒã€å€¤ã«ã‚¿ã‚¤ãƒ—ãŒãªã„ã‚ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚å˜ç´”ã«ã€è¨ˆç®—ãƒ»å‡¦ç†ãŒè¡Œã‚ã‚Œã‚‹ã‚ˆã†ã«ãªã‚‹ã¾ã§ã€å€¤ã«å¯¾ã—ã¦ã€Œæš—é»™çš„ãªã€å¼·åˆ¶ã‚¿ã‚¤ãƒ—å¤‰æ›ãŒèµ·ã“ã£ã¦ã„ã‚‹ã‹ã‚‰ã§ã™ã€‚ã“ã®ç‰¹æ€§ã«ã‚ˆã£ã¦ã€æƒ³å®šå¤–ã®ã€Œã‚µãƒ—ãƒ©ã‚¤ã‚ºã€ã«ãªã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚ä¾‹ãˆã°ã€æ¬¡ã®å‡ºåŠ›ãŒã‚ã‹ã‚‹ã®ã§ã—ã‚‡ã†ã‹ã€‚

```js
console.log(!!'false')
console.log('3' - 1)
console.log(1 + '')
console.log( + {} )
console.log( + [] )
console.log([[]] + 1)
console.log([{}] + 1)
console.log([] + {})
console.log({} + {})
console.log({} - {})
```

å¼·åˆ¶å¤‰æ›ã¯ä»–ã®Javaã€Cã€Rustãªã©é™çš„å‹ä»˜ã‘è¨€èªã«ãŠã‘ã‚‹ã€ã„ã‚ã‚†ã‚‹ã‚¿ã‚¤ãƒ—ã‚­ãƒ£ã‚¹ãƒˆï¼ˆtype castï¼‰ã¨ã¯ã¾ãŸæ€§è³ªãŒé•ã„ã¾ã™ã€‚ã¨è¨€ã†ã®ã¯ã€ã‚‚ã¡ã‚ã‚“ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã®ã‚¿ã‚¤ãƒ—ãƒã‚§ãƒƒã‚¯ãŒãªã„ã—ã€type coercionã¯**å®Ÿè¡Œæ™‚ï¼ˆruntimeï¼‰ã«jsã‚¨ãƒ³ã‚¸ãƒ³ãŒå‹æ‰‹ã«è¡Œã£ã¦ã„ã‚‹è¡Œç‚º**ã§ã™ã€‚ã¾ãŸã€ã“ã®ã€Œæš—é»™çš„ã€ï¼ˆimplicitï¼‰ãªã‚¿ã‚¤ãƒ—å¤‰æ›ã¯ã€`Number('123')`ã€`Boolean('a')`ã€`true.toString()`ã¨ã‹ã¨è¨€ã†é¡•åœ¨çš„ãªï¼ˆexplicitï¼‰ã‚¿ã‚¤ãƒ—å¤‰æ›ã¨è¨€ã†ã®ã‚‚ã€ã±ã£ã¨è¦‹ã§å¤‰æ›ãŒè¡Œã‚ã‚Œã¦ã„ã‚‹ã®ãŒã‚ã‹ã‚‹ã‹ã©ã†ã‹ã¨è¨€ã†æ„å‘³ã§è‹¥å¹²é•ã„ã¾ã™ï¼ˆãƒ‘ãƒƒã¨è¦‹ã§ã‚ã‹ã‚‹ã¨è¨€ã†ã®ã¯çµŒé¨“ã«å·¦å³ã•ã‚Œã‚„ã™ã„ãŒã€ä¸€æ—¦ã“ã®è¡¨ç¾ã«ã•ã›ã¦ãã ã•ã„ï¼‰ã€‚

ã¤ã¾ã‚Šã€ã“ã®ä»•æ§˜ã¯ä»–ã®è¨€èªã«ã¯ã‚ã¾ã‚Šè¦‹ã‚‰ã‚Œãªã„ã€JSã®ç‰¹å¾´çš„ãªã‚‚ã®ã¨ã—ã¦è€ƒãˆã‚‰ã‚Œã¾ã™ã€‚ã€Œtsä½¿ãˆã°è‰¯ã„ã˜ã‚ƒã‚“ã€ã¨æ€ã†ã®ã¯æœ€ã‚‚ã ã¨æ€ã„ãªãŒã‚‰ã€tsã¯ã‚ãã¾ã§ã‚‚jsã‚’ãƒ™ãƒ¼ã‚¹ã«ã—ã¦ã„ã‚‹ã‹ã‚‰ã€ã€Œãªãœã“ã“ã®ã‚¿ã‚¤ãƒ—ãŒåˆã‚ãªã„ã®ã‹ã€ã‚’ç†è§£ã™ã‚‹ãŸã‚ã«ã‚‚ã€ã“ã®ä»•æ§˜ã¸ã®ç†è§£ãŒä¸å¯æ¬ ã«ãªã£ã¦ã„ã‚‹ã¨æ€ã„ã¾ã™ã€‚

## å¼·åˆ¶å¤‰æ›ã®ä»•çµ„ã¿

ã“ã“ã§ã¯ã€[ECMAã‚¹ãƒšãƒƒã‚¯](https://262.ecma-international.org/13.0/#sec-type-conversion)ã‚’è»¸ã«ã€ä¸­ã«å®šã‚ã‚‰ã‚Œã¦ã„ã‚‹åŸºæœ¬ã‚¿ã‚¤ãƒ—ï¼ˆprimitive typesï¼‰ã¸ã®å¤‰æ›ã®å®šç¾©ã‚’å°‘ã—èª¬æ˜ã—ã¾ã™ï¼ˆ`BigInt`ã«é–¢ã—ã¦ã¯ä»Šå›å‰²æ„›ï¼‰ã€‚

### ToString

ã¾ãšæ–‡å­—åˆ—ã¸ã®å¤‰æ›ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚ã‚ªãƒªã‚¸ãƒŠãƒ«ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã¯[ã“ã¡ã‚‰](https://262.ecma-international.org/13.0/#sec-tostring)ã¨ãªã‚Šã¾ã™ã€‚

| å¤‰æ›å…ƒã®ã‚¿ã‚¤ãƒ— | å¤‰æ›çµæœ                                            |
| -------------- | --------------------------------------------------- |
| `Undefined`    | `"undefined"`                                       |
| `Null`         | `"null"`                                            |
| `Boolean`      | `"true"`ã¾ãŸã¯`"false"`                             |
| `Number`       | `Number::toString(arg)`ã®ãƒªã‚¿ãƒ¼ãƒ³å€¤                 |
| `String`       | ã‚¤ãƒ³ãƒ—ãƒƒãƒˆå€¤ã®ã¾ã¾                                  |
| `Symbol`       | `TypeError exception`ã‚’ã‚¹ãƒ­ãƒ¼                       |
| `Object`       | `ToPrimitive`ã®ãƒªã‚¿ãƒ¼ãƒ³å€¤ -> `ToString`ã®ãƒªã‚¿ãƒ¼ãƒ³å€¤ |

`Undefined`ã‚„`Null`ã¯ãã®ã¾ã¾â€â€ã‚’ã¤ã‘ã¦æ–‡å­—åˆ—ã«ãªã£ã¦ã„ã¾ã™ã€‚APIã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æŠ•ã’ã‚‹ã¨ãã«ã€query stringãŒã‚‚ã—`undefined`ã¨ãªã£ã¦ã„ãŸã‚‰ã€query stringã¯æ–‡å­—åˆ—ã«å¤‰æ›ã•ã‚Œã‚‹ã®ã§ã€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã§æ–‡å­—åˆ—ã®`"undefined"`ãŒå±Šãã®ãŒã“ã®ãŸã‚ã§ã™ã€‚

ãƒ–ãƒ¼ãƒ«ã‚¿ã‚¤ãƒ—ã‚‚ã€å€¤ã«ã‚ˆã£ã¦ã€`"true"`ã‹`"false"`ã®æ–‡å­—åˆ—ã«ãªã‚Šã¾ã™ã€‚ã“ã‚Œã¯`true.toString()`ã¨åŒã˜çµæœã¨ãªã‚Šã¾ã™ã€‚``The answer is ${true}``ã‚’æ›¸ãã¨ãã«ã€`true`ã¯æš—é»™çš„ã«æ–‡å­—åˆ—ã«å¤‰æ›ã•ã‚Œã¦ã„ã¾ã™ã€‚

æ•°å­—ã‚‚ç„¶ã‚Šã€åŸºæœ¬çš„ã«â€â€ã§å›²ã‚ã°ã‚ˆã„ã§ã—ã‚‡ã†ã€‚`NaN`ã‚‚ä¾‹å¤–ãªãã€`"NaN"`ã«ãªã‚‹ã ã‘ã§ã™ã€‚

ã‚·ãƒ³ãƒœãƒ«ã¯æš—é»™çš„ãªå¤‰æ›ãŒã§ãã¾ã›ã‚“ã€‚ã“ã‚Œã¯ã‚·ãƒ³ãƒœãƒ«ã®ã€Œå”¯ä¸€ç„¡äºŒã€ã®ç‰¹æ€§ã¨é–¢ã‚ã‚‹ã‚‚ã®ã§ã€æš—é»™çš„ã«å¤‰æ›ã™ã‚‹ã“ã¨ãŒè¨±ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ã‚·ãƒ³ãƒœãƒ«ã‚’æ–‡å­—åˆ—ã«å¤‰æ›ã™ã‚‹ã«ã¯ã€é¡•åœ¨çš„ã«`toString()`ã‚’å‘¼ã³å‡ºã™ã‹ã€`symbol.description`ã§è¨˜è¿°ã‚’æ–‡å­—åˆ—ã¨ã—ã¦å–ã‚Šå‡ºã™ã“ã¨ãŒå¿…è¦ã§ã™ã€‚

```js
let symbol = Symbol('special') 
console.log(symbol) // type error
console.log(symbol.toString()) // 'Symbol(special)'
console.log(symbol.description) // 'special'
```

æœ€å¾Œã®`Object`ã«é–¢ã—ã¦ã¯ä¸€æ—¦ä¼ã›ã¾ã™ã€‚å¾Œã§èª¬æ˜ã—ã¾ã™ãŒã€`ToPrimitive`ã‚’ç†è§£ã—ãŸã‚‰è‡ªç„¶ã«åˆ†ã‹ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

### ToNumber

æ¬¡ã¯[`ToNumber`ã®æ–¹](https://262.ecma-international.org/13.0/#sec-tonumber)ã§ã™ã€‚

| å¤‰æ›å…ƒã®ã‚¿ã‚¤ãƒ— | å¤‰æ›çµæœ                                            |
| -------------- | --------------------------------------------------- |
| `Undefined`    | `NaN`                                               |
| `Null`         | `+0`                                                |
| `Boolean`      | `1`ã¾ãŸã¯`+0`                                       |
| `Number`       | ã‚¤ãƒ³ãƒ—ãƒƒãƒˆå€¤ã®ã¾ã¾                                  |
| `String`       | æ•°å­—ã‹`NaN`                                         |
| `Symbol`       | `TypeError exception`ã‚’ã‚¹ãƒ­ãƒ¼                       |
| `Object`       | `ToPrimitive`ã®ãƒªã‚¿ãƒ¼ãƒ³å€¤ -> `ToNumber`ã®ãƒªã‚¿ãƒ¼ãƒ³å€¤ |

`+0`ã«ã¤ã„ã¦ä»Šå›ã®ã‚¹ã‚³ãƒ¼ãƒ—å¤–ã«ãªã‚Šã¾ã™ãŒã€èˆˆå‘³ã®ã‚ã‚‹æ–¹ã¯`signed zero`ã¨ã‹ã§æ¤œç´¢ã—ã¦ã¿ã¦ã‚‚è‰¯ã„ã§ã—ã‚‡ã†ï¼ˆ[ã“ã¡ã‚‰](https://medium.com/coding-at-dawn/is-negative-zero-0-a-number-in-javascript-c62739f80114)ã«ã‚‚å‚è€ƒã«ï¼‰ã€‚æ³¨æ„ã—ãŸã„ã®ã¯ã€`Undefined`ã¨`Null`ãŒå¤šãã®ã¨ã“ã‚ã§çµæ§‹ä¼¼ã¦ã„ã‚‹æŒ™å‹•ã«ãªã‚‹ãŒï¼ˆ`undefined == null`ï¼‰ã€æ•°å­—ã«å¤‰æ›ã•ã‚Œã‚‹ã¨ãã¯é•ã„ã¾ã™ã€‚

æ–‡å­—åˆ—ã‹ã‚‰æ•°å­—ã¸ã®å¤‰æ›ã®ä¸­èº«ã¯çµæ§‹è¤‡é›‘ã§ã™ã€‚`StringToNumber`ã®å¤‰æ›ã«ã¯ã€4ã¤ã®ã‚¹ãƒ†ãƒƒãƒ—ãŒã‚ã‚Šã¾ã™ã€‚

ã‚¹ãƒ†ãƒƒãƒ—1ã§ã¯ã€ã‚¤ãƒ³ãƒ—ãƒƒãƒˆã®ãƒ†ã‚­ã‚¹ãƒˆï¼ˆæ–‡å­—åˆ—ã¨ã„ã†ãƒ‡ãƒ¼ã‚¿ã‚¿ã‚¤ãƒ—ã®ãƒ‹ãƒ¥ã‚¢ãƒ³ã‚¹ã§ã¯ãªãã€ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒå‡¦ç†ã™ã‚‹ã‚¤ãƒ³ãƒ—ãƒƒãƒˆã®ãƒ†ã‚­ã‚¹ãƒˆï¼‰ã«å¯¾ã—ã¦ã€UTF-16ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸUnicodeã®ã‚³ãƒ¼ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ãƒªã‚¹ãƒˆã«å¤‰æ›ã—ã¾ã™ã€‚ã‚³ãƒ¼ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¨ã„ã†ã®ã¯ã€`U+1234`ã¨ã„ã£ãŸãƒ¦ãƒ‹ã‚³ãƒ¼ãƒ‰æ–‡å­—ã‚’è¡¨ã—ã¦ã„ã‚‹ãƒ†ã‚­ã‚¹ãƒˆã®ã“ã¨ã§ã™ã€‚

ã‚¹ãƒ†ãƒƒãƒ—2ã§ã¯ã€1ã§å¾—ã‚‰ã‚ŒãŸãƒ¦ãƒ‹ã‚³ãƒ¼ãƒ‰ã®ãƒªã‚¹ãƒˆã‚’å–ã‚Šå…¥ã‚Œã¦ã€ãƒªãƒ†ãƒ©ãƒ«ã¸è§£æã‚’è©¦ã™ã€‚ã‚¹ãƒ†ãƒƒãƒ—3ã§ã¯ã€ã‚¹ãƒ†ãƒƒãƒ—2ã®è§£æã®ãƒ—ãƒ­ã‚»ã‚¹ã«ã‚‚ã—ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸã‚‰ã€`NaN`ã‚’ãƒªã‚¿ãƒ¼ãƒ³ã™ã‚‹ã€‚ã‚‚ã—å•é¡ŒãŒç™ºç”Ÿã—ãªã‘ã‚Œã°ã€æœ€å¾Œã®ã‚¹ãƒ†ãƒƒãƒ—4ã«ç§»ã—ã€[ã„ãã¤ã‹ã®ãƒ«ãƒ¼ãƒ«](https://262.ecma-international.org/13.0/#sec-runtime-semantics-stringnumericvalue)ã‚’å…ƒã«æ•°å­—ã¸ã¨å¤‰æ›ã™ã‚‹ã€‚ä¾‹ãˆã°ã€ãƒ›ãƒ¯ã‚¤ãƒˆã‚¹ãƒšãƒ¼ã‚¹ã®ã¿ã®å ´åˆã¯ã€ã©ã‚Œã ã‘ã‚¹ãƒšãƒ¼ã‚¹ã‚ã£ã¦ã‚‚`0`ã¨å¤‰æ›ã—ãŸã‚Šã€`-/+`ã¨ã„ã£ãŸè¨˜å·ãŒå…¥ã‚‹å ´åˆã¯å¯¾å¿œã™ã‚‹ãƒã‚¸ãƒ†ã‚£ãƒ–ãƒ»ãƒã‚¬ãƒ†ã‚£ãƒ–ãªæ•°å­—ã«å¤‰æ›ã—ãŸã‚Šã™ã‚‹ã¨ã‹ã€‚

æ­£ç›´ECMAã‚’èª­ã¿é€šã—ã¦ã‚‚ã€è¨€èªè§£æãªã©ã®å°‚é–€çŸ¥è­˜ãŒãªã„ã¨ã‹ãªã‚Šç†è§£ã—ã«ãã„å†…å®¹ã§ã—ãŸã€‚`StringToNumber`ã®å¤‰æ›ã‚’ã‚·ãƒ³ãƒ—ãƒ«ã«è¨€ãˆã°ã€æ–‡å­—åˆ—ã§è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹ã€Œæ­£ã—ã„æ•°å­—ã€ã¸ã®å¤‰æ›ã‚’è©¦ã¿ã‚‹ãŒã€å¤±æ•—ã—ãŸå ´åˆã¯å…¨ã¦`NaN`ã«ãªã‚‹ã‚ˆã€ã¨ã®ã“ã¨ã§ã™ã€‚

ã‚ˆããƒãƒã‚Šã‚„ã™ã„ä¾‹ã‚’è¦‹ã¦ã¿ã‚‹ã¨ã€

```js
Number("Infinity") // Infinity
Number("infinity") // NaN
Number("1") // 1
Number("-1") // -1
Number("-1+1") // NaN
Number("       ") // 0
```

æœ€å¾Œã®`Object`ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯ã¾ãŸ`ToPrimitive`ã®ç¯€ã§èª¬æ˜ã—ã¾ã™ã€‚


### ToBoolean

[`ToBoolean`](https://262.ecma-international.org/13.0/#sec-toboolean)ã‚‚è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

| å¤‰æ›å…ƒã®ã‚¿ã‚¤ãƒ— | å¤‰æ›çµæœ                                      |
| -------------- | --------------------------------------------- |
| `Undefined`    | `false`                                       |
| `Null`         | `false`                                       |
| `Boolean`      | ã‚¤ãƒ³ãƒ—ãƒƒãƒˆå€¤ã®ã¾ã¾                            |
| `Number`       | `+0`,`-0`, `NaN`ã®å ´åˆã¯`false`ã€ä»¥å¤–ã¯`true` |
| `String`       | str.lengthãŒ0ãªã‚‰`false`ã€ä»¥å¤–ã¯`true`        |
| `Symbol`       | `true`                                        |
| `Object`       | `true`                                        |

ãƒ–ãƒ¼ãƒ«ã‚¿ã‚¤ãƒ—ã®å¤‰æ›ã¯ä¸€è¦‹ã‚ã¾ã‚Šå¤‰å“²ã‚‚ãªã„ãƒ†ãƒ¼ãƒ–ãƒ«ã§ã™ãŒã€å¤šå°‘ç½ ã‚‚ã‚ã‚Šã¾ã™ã€‚ä¾‹ãˆã°ã€`!![]`ã¯`false`ã¨é–“é•ã„ã‚„ã™ã„ãŒã€JSã®é…åˆ—ã¯`Object`ãªã®ã§ã€`true`ã«ãªã‚Šã¾ã™ï¼ˆã“ã‚Œã¯ç­†è€…ãŒéå»ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§è¦‹ãŸã“ã¨ã®ã‚ã‚‹ãƒŸã‚¹ã§ã™ï¼‰ã€‚æ•°å­—ã®å ´åˆã‚‚ã‚ˆãæ¼ã‚Œã‚„ã™ã„ã®ã¯ã€æ–‡å­—åˆ—ã‚’æ•°å­—ã«å¤‰æ›ã™ã‚‹ã®ãŒå¤±æ•—ã—ã€`NaN`ã®ã¾ã¾ã§ãƒ–ãƒ¼ãƒ«å¤‰æ›ã•ã‚Œã¦`false`ã¨ãªã‚‹ã‚±ãƒ¼ã‚¹ã§ã™ã€‚

ãƒ–ãƒ¼ãƒ«ã‚¿ã‚¤ãƒ—ã®å¤‰æ›ã«ã¯å‰²ã¨ã‚·ãƒ³ãƒ—ãƒ«ãªå´é¢ãŒã‚ã‚Šã¾ã™ã€‚ã¨ã„ã†ã®ã¯ã€ãƒ•ã‚©ãƒ«ã‚·ãƒ¼ï¼ˆfalsyï¼‰ãªå€¤ã‚’è¦šãˆã¦ãŠã‘ã°ã€ä»–ã¯å…¨éƒ¨trueã«ãªã‚‹ã“ã¨ã§ã™ã€‚ä¸Šè¨˜ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰æŠœç²‹ã™ã‚‹ã¨ã€ä»¥ä¸‹ã¨ãªã‚Šã¾ã™ã€‚

- `undefined`
- `null`
- `false`
- `0`
- `NaN`
- `""`

ãƒ–ãƒ¼ãƒ«ã‚¿ã‚¤ãƒ—ã¸ã®å¤‰æ›æ–¹æ³•ã¯ã€`Boolean(x)`ã ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ä»–ã«ã‚‚ã‚ˆãå‡ºä¼šã†å¼·åˆ¶å¤‰æ›ãŒè¡Œã‚ã‚Œã¦ã„ã‚‹ç®‡æ‰€ã¯ä»¥ä¸‹ã¨ãªã‚Šã¾ã™ã€‚

- `!`ã¨`!!`ã€`!a`ã¯`a`ã‚’ãƒ–ãƒ¼ãƒ«ã‚¿ã‚¤ãƒ—ã¸å¤‰æ›ã—ã¦ã‹ã‚‰åè»¢ã™ã‚‹
- ifæ–‡ã®æ¡ä»¶ã€`if (...)`ã‚«ãƒƒã‚³å†…ã®å€¤ã¯ãƒ–ãƒ¼ãƒ«ã‚¿ã‚¤ãƒ—ã¸å¤‰æ›ã™ã‚‹
- for i ãƒ«ãƒ¼ãƒ—ã®2å€‹ç›®ã®ãƒ«ãƒ¼ãƒ—æ¡ä»¶ã€ä¸Šè¨˜ã¨åŒã˜
- whileãƒ«ãƒ¼ãƒ—ï¼ˆ`do while`ã‚‚å«ã‚€ï¼‰ã®æ¡ä»¶ã€ä¸Šè¨˜ã¨åŒã˜
- `&&`æ¼”ç®—ã€`a && b`ã§ã¯ã€`a`ã‚’ãƒ–ãƒ¼ãƒ«ã‚¿ã‚¤ãƒ—ã¸å¤‰æ›ã™ã‚‹
- `||`æ¼”ç®—ã€ä¸Šè¨˜ã¨åŒã˜ã
- `a ? b : c`ä¸‰é …æ¡ä»¶æ¼”ç®—ã€`a`ã‚’ãƒ–ãƒ¼ãƒ«ã‚¿ã‚¤ãƒ—ã¸å¤‰æ›ã™ã‚‹

### ToPrimitive

ã•ã¦ã€JSã®ã‚¿ã‚¤ãƒ—ã‚’å¤§ããåˆ†ã‘ã‚‹ã¨ã€primitiveã¨objectã®2ç¨®é¡ã«åˆ†ã‘ã‚‰ã‚Œã¾ã™ã€‚ã¤ã¾ã‚Šã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ(`{}`ã€`[]`ã€`Date`ãªã©ã‚’å«ã‚€)ä»¥å¤–ã¯å…¨éƒ¨primitiveã‚¿ã‚¤ãƒ—ã¨ãªã‚Šã¾ã™ã€‚ãã‚Œã§ã€[ToPrimitiveã®æ“ä½œ](https://262.ecma-international.org/13.0/#sec-toprimitive)ã¯ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚¿ã‚¤ãƒ—ã®å€¤ã‚’ã€åŸºæœ¬ã‚¿ã‚¤ãƒ—ã¸ã®å¤‰æ›ã‚’æŒ‡ã—ã¦ã„ã¾ã™ã€‚

ãŸã ã€åŸºæœ¬ã‚¿ã‚¤ãƒ—ã«ã¯è¤‡æ•°å­˜åœ¨ã™ã‚‹ã—ã€å¤‰æ›å…ˆã®ã‚¿ã‚¤ãƒ—ã¯ã©ã†ã‚„ã£ã¦æ±ºã¾ã‚‹ã®ã€ã¨ç–‘å•ã«ãªã‚‹ã§ã—ã‚‡ã†ã€‚ã“ã“ã‚‚è‹¥å¹²è¤‡é›‘ãªã‚¹ãƒ†ãƒƒãƒ—ãŒã‚ã‚Šã¾ã™ãŒã€æ•´ç†ã—ã¦ã¿ã‚‹ã¨ï¼š

1. `@@toPrimitive`ã‚·ãƒ³ãƒœãƒ«ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè¡Œã€å®Ÿè¡Œæ™‚ã«*æœ›ã¾ã—ã„å¤‰æ›´å…ˆ*ã®ãƒ’ãƒ³ãƒˆã¯`string`ã‹`number`ã‹ã‚’ç¢ºèª
2. ã‚‚ã—æœ›ã¾ã—ã„å¤‰æ›´å…ˆãŒ`string`ã®å ´åˆã€å¤‰æ›ã®å„ªå…ˆé †ä½ã‚’`ToString -> ToNumber`ã¨ã—ã€é€†ã®å ´åˆã¯`ToNumber -> ToString`ã¨ã™ã‚‹
3. `string`ã¸å¤‰æ›ã™ã‚‹å ´åˆã¯`toString()`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã—ã€`number`ã¸å¤‰æ›ã™ã‚‹å ´åˆã¯`valueOf`ã‚’å‘¼ã³å‡ºã™
4. `toString()`ã¨`valueOf()`ã®ãƒªã‚¿ãƒ¼ãƒ³å€¤ãŒåŸºæœ¬ã‚¿ã‚¤ãƒ—ã¨ãªã‚Œã°ã€ãã®æ™‚ç‚¹ã§å¤‰æ›çµ‚äº†
   1. å„ªå…ˆãƒ¡ã‚½ãƒƒãƒ‰ãŒå¤±æ•—ã—ãŸå ´åˆã¯ã€å€™è£œãƒ¡ã‚½ãƒƒãƒ‰ã®æ–¹ã‚’å®Ÿè¡Œ
   2. ã©ã‚Œã‚‚ãƒ€ãƒ¡ã ã£ãŸå ´åˆï¼ˆåŸºæœ¬ã‚¿ã‚¤ãƒ—ã®å€¤ã«å¤‰æ›ã§ããšï¼‰ã¯`TypeError`ã‚’ã‚¹ãƒ­ãƒ¼

ãã‚Œã§ã€ã“ã®*æœ›ã¾ã—ã„å¤‰æ›´å…ˆ*ã¯ã©ã†ã‚„ã£ã¦æ±ºã‚ã‚‹ã‹ãŒã‚ã‹ã‚Šã¥ã‚‰ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚åŸºæœ¬çš„ã«ãƒ’ãƒ³ãƒˆãªã—ã®å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¨ã—ã¦`number`ã¨å¤‰æ›ã—ã¾ã™ã€‚

ã ã£ãŸã‚‰ã€ãƒ’ãƒ³ãƒˆã‚ã‚Šã®å ´åˆã¨ã„ã†ã®ã¯ã©ã‚“ãªå ´åˆã ã‚ã†ã‹ã€‚ä¾‹ãˆã°ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ–‡å­—åˆ—ã«å…¥ã‚Œã‚‹ã¨ã‹ã€**æ•°å­—**ã¨æ•°å­¦æ¼”ç®—ï¼ˆ+/-/*ãªã©ï¼‰ã™ã‚‹ã¨ã‹ã€ãŒç›®å°ã«ãªã‚Šã¾ã™ã€‚ã“ã“ã§å°‘ã—ä¾‹ã§è€ƒãˆã¾ã—ã‚‡ã†ã€‚

```js
const myObj = {
  toString() {
    console.log('toString invoked')
    return 'my obj'
  },
  valueOf() {
    console.log('valueOf invoked')
    return -1
  }
}

String(myObj) // my obj
myObj + 1 // 0
myObj + '' // '-1' => æ„å¤–ã‹ã‚‚ï¼Ÿ
-myObj // 1
myObj*100 // -100
```

ä¸‰ã¤ç›®ã®è¨ˆç®—çµæœã¯æ–‡å­—åˆ—ã®`'-1'`ã¨ãªã£ã¦ã„ã‚‹ã€‚`+`ãŒã‚ã‚‹ã®ã§æ•°å­¦æ¼”ç®—ã¨ã„ã†ã“ã¨ã§ã€`myObj`ã‚’å¼·åˆ¶å¤‰æ›ã™ã‚‹ã¨ãã«å„ªå…ˆçš„ã«`valueOf`ãŒå‘¼ã³å‡ºã•ã‚Œã‚‹ã€ã¨å‹˜é•ã„ã•ã‚Œã‚„ã™ã„ãŒã€æœ¬å½“ã¯`+''`ã¯ãƒ’ãƒ³ãƒˆãªã—ã®ã‚±ãƒ¼ã‚¹ã¨ãªã£ã¦ã„ã¾ã™ï¼ˆã“ã®ç†ç”±ã«ã¤ã„ã¦`+ xxx`ã¯æ–‡å­—åˆ—é€£çµã‚„æ•°å­—ã®æ›ã‘ç®—ã¨ã„ã†2ã¤ã®è§£é‡ˆãŒå¯èƒ½ã®ãŸã‚ãƒ’ãƒ³ãƒˆã«ã¯ãªã‚‰ãªã„ã¨å€‹äººçš„ãªæ¨æ¸¬ï¼‰ã€‚ãƒ’ãƒ³ãƒˆãªã—ã®å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®`number`ãŒå¤‰æ›å…ˆãªã®ã§ã€çµæœçš„ã«`valueOf`ãŒå‘¼ã³å‡ºã•ã‚Œã¦ã„ã‚‹ã ã‘ã§ã™ã€‚ãŸã ã€`+`æ¼”ç®—å­ã®äºŒã¤ã®è¢«æ¼”ç®—å­ï¼ˆoperandï¼‰ã®ã„ãšã‚ŒãŒæ–‡å­—åˆ—ã®å ´åˆã¯ã€æ–‡å­—åˆ—é€£çµæ“ä½œã¨ãªã‚‹ï¼ˆ[ã“ã¡ã‚‰](https://262.ecma-international.org/13.0/#sec-applystringornumericbinaryoperator)ï¼‰ã®ã§ã€çµæœçš„ã«numberãŒstringã¸å¤‰æ›ã•ã‚Œã¾ã™ã€‚

ã¾ãŸã€å…ˆã»ã©ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒ’ãƒ³ãƒˆãŒ`number`ã¨è¿°ã¹ã¾ã—ãŸãŒã€ä¾‹å¤–ã¨ã—ã¦`Date`ã®`@@toPrimitive`ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ’ãƒ³ãƒˆã¯`string`ã¨ãªã£ã¦ã„ã¾ã™ã€‚

```js
let d = new Date()
d + '' // '2023-01-28T09:05:02.163Z'
String(d) // '2023-01-28T09:05:02.163Z'
+d // 1674896702163
```

## è¬ã‚’è§£ã„ã¦ã„ã

### ãƒ’ãƒ³ãƒˆã®æ­£ä½“ã‚’ã°ã‚‰ã™

ã“ã®ãƒ’ãƒ³ãƒˆã¯ä¸€ä½“ãªã‚“ãªã®ã‹ã‚’ã•ã‚‰ã«æ·±æ˜ã‚Šã—ã¦ã„ãã¾ã™ã€‚å®Ÿã¯ã€`ToPrimitive`ã¨ã„ã†æ“ä½œãŒã€[ã‚·ãƒ³ãƒœãƒ«ã¨ã—ã¦å®šç¾©](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Symbol/toPrimitive)ã•ã‚Œã¦ã„ã¾ã™ã€‚

```js
const myObj = {
  [Symbol.toPrimitive](hint) {
    console.log(`toPrimitive invoked with hint: ${hint}`);
    return 100
  },
  toString() {
    console.log('toString invoked')
    return 'my obj'
  },
  valueOf() {
    console.log('valueOf invoked')
    return -1
  }
}

String(myObj) //  toPrimitive invoked with hint: string
`${myObj} in a template string` // toPrimitive invoked with hint: string
+myObj //  toPrimitive invoked with hint: number
myObj*3 //  toPrimitive invoked with hint: number
myObj + '' // toPrimitive invoked with hint: default
```

`ToString`ã¨`ToNumber`ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã®æœ€å¾Œã®è¡Œã‚’æ€ã„å‡ºã—ã¦ãã ã•ã„ã€‚ã“ã®å¤‰æ›ã«ã¯2ã¤ã®ã‚¹ãƒ†ãƒƒãƒ—ãŒã‚ã‚Šã¾ã™ãŒã€æœ€åˆã«`ToPrimitive`ã€ã¤ã¾ã‚Šã“ã“ã§æˆ‘ã€…ãŒå®šç¾©ã—ãŸ`Symbol.toPrimitive`ãƒ¡ã‚½ãƒƒãƒ‰ãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚ã“ã®æ®µéšã§å¾—ã‚‰ã‚ŒãŸåŸºæœ¬ã‚¿ã‚¤ãƒ—ã®å€¤ãŒã€ãƒ’ãƒ³ãƒˆã«ã‚ˆã£ã¦`toString`ã«æ¸¡ã™ã‹ã€`valueOf`ã«æ¸¡ã™ã‹ãŒæ±ºã‚ã‚‰ã‚Œã¾ã™ã€‚ã“ã®å ´åˆã€æˆ‘ã€…ãŒå®šç¾©ã—ãŸ`toString`ã¾ãŸã¯`valueOf`ãŒå®Ÿè¡Œã•ã‚Œã¾ã›ã‚“ã€‚ã‚‚ã—`toPrimitive`ã®æ®µéšã§åŸºæœ¬ã‚¿ã‚¤ãƒ—ã®å€¤ã‚’ãƒªã‚¿ãƒ¼ãƒ³ã—ãªã‹ã£ãŸã‚‰ã€ã‚¿ã‚¤ãƒ—å¤‰æ›ã§ããªã„ã‚¨ãƒ©ãƒ¼ãŒã‚¹ãƒ­ãƒ¼ã•ã‚Œã¾ã™ã€‚

### `+[]`ã¨`+{}`ã®é•ã„ã¯ï¼Ÿ

ä»Šã¾ã§ã®ãƒ’ãƒ³ãƒˆã§è€ƒãˆã‚‹ã¨ã€`[]`ã«ã—ã¦ã‚‚ã€`{}`ã«ã—ã¦ã‚‚ã€ã„ãšã‚Œã‚‚`number`ã¸å¤‰æ›ã•ã‚Œã‚‹ã¯ãšã§ã™ã€‚ãŸã çµæœã¯é•ã„ã¾ã™ã€‚

```js
console.log(+{}) // NaN
console.log(+[]) // 0
```

`+`ã‚’å‰ã«ã¤ã‘ã‚‹ã“ã¨ã§ã€ãƒ’ãƒ³ãƒˆã¯`number`ã ã¨ã‚ã‹ã£ã¦ã€ãã‚Œã§`valueOf`ãŒå®Ÿè¡Œã•ã‚Œã¾ã™ãŒã€[ã“ã¡ã‚‰ã®èª¬æ˜](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/toString#description)ã®ã‚ˆã†ã«ã€`valueOf`ãƒ¡ã‚½ãƒƒãƒ‰ã§è¿”ã—ãŸå€¤ã¯ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãã®ã¾ã¾ã«ãªã‚Šã¾ã™ã€‚

```js
{}.valueOf() // {}
[].valueOf() // []
```

ã“ã‚Œã§ã¯åŸºæœ¬ã‚¿ã‚¤ãƒ—ã®å€¤ã«å¤‰æ›ã§ãã¾ã›ã‚“ã®ã§ã€çµå±€`toString`ãŒã‚‚ã†ä¸€åº¦å‘¼ã³å‡ºã•ã‚Œã¾ã™ã€‚è–„ã€…åŸå› ã‚’å¯Ÿã—ã¦ã„ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€ã“ã®é•ã„ã‚’ç”Ÿã˜ãŸã®ã¯ã€`toString`å®Ÿè£…ã®æœ‰ç„¡ã«ã‚ã‚Šã¾ã™ã€‚ã“ã®`toString`ã¯ãƒ“ãƒ«ãƒ‰ã‚¤ãƒ³ã®`Object`å‹ï¼ˆ`{}`ï¼‰ã«ã¯å®Ÿè£…ãŒãªã„ãŒã€é…åˆ—ã®`toString`ãƒ¡ã‚½ãƒƒãƒ‰ã¯ã‚ã‚Šã¾ã™ã€‚

```js
let l = [1,2,3]
l.toString() // '1,2,3'
[].toString() // ''
String([ null, undefined ]) // ','
```
é…åˆ—ã®`toString`ã¯ã€è¦ç´ ã«[ã‚³ãƒ³ãƒã§é€£çµ](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/toString)ã—ã¦ã„ã¾ã™ã€‚ã¤ã¾ã‚Š`arr.join()`ã®ã“ã¨ã§ã™ã€‚ãŸã ã€`join`ãƒ¡ã‚½ãƒƒãƒ‰ã¯ã™ã¹ã¦ã®é…åˆ—è¦ç´ ã‚’æ–‡å­—åˆ—ã¸å¤‰æ›ã™ã‚‹ãŸã‚ã€`null`ã¨`undefined`ã¯`'null'`ã¨`'undefined'`ã«ãªã‚‹ã¯ãšã€ã¨æ€ã£ãŸã‚Šã™ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€ã“ã‚Œã¯[ãŸã ã®ä¾‹å¤–](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/join#description)ã«ãªã‚Šã¾ã™ã€‚

`+[]`ã¨`+{}`ã®å•é¡Œã«æˆ»ã‚‹ã¨ã€`[]`ã¯`''`ã¨ãªã‚Šã€ã“ã‚Œã‚’`number`ã«å¤‰æ›ã™ã‚Œã°ã€`0`ã¨ãªã‚‹ã®ã§ã™ã€‚ä¸€æ–¹ã§ã€`toString`ã®ãŠã‹ã’ã§ã€`{}`ãŒ`'[object Object]'`ï¼ˆæ¬¡ã§èª¬æ˜ï¼‰ã«ãªã‚Šã€æ•°å­—ã«ã—ãŸã‚‰`NaN`ã«ãªã£ã¦ã—ã¾ã„ã¾ã™ã€‚ãã®ãŸã‚ã€åŒã˜ãæ•°å­—ã¸ã®å¼·åˆ¶å¤‰æ›ã§ã™ãŒã€çµæœã¯é•ã„ã¾ã—ãŸã€‚

### `[object Object]`ã¨ã¯ä½•ï¼Ÿ

`[object Object]`ã¨ã„ã†æ–‡å­—åˆ—ã¯JSé–‹ç™ºè€…ã«ã¨ã£ã¦ã€èª°ã—ã‚‚è¦‹è¦šãˆã®ã‚ã‚‹ã€Œè¨³ã®ã‚ã‹ã‚‰ãªã„æ–‡å­—åˆ—ã€ã‹ã¨æ€ã„ã¾ã™ãŒã€ã“ã‚Œã¯ã€`toString()`ãƒ¡ã‚½ãƒƒãƒ‰ãŒå®Ÿè£…ã•ã‚Œã¦ã„ãªã„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¯¾ã—ã¦ã€å†…éƒ¨å±æ€§ã®`[[Class]]`ã®å€¤ã‚’ãƒªã‚¿ãƒ¼ãƒ³ã—ã¦ã„ã‚‹ã€‚ã‚‚ã¡ã‚ã‚“ã€å…ˆã»ã©ã®`myObj`ã®ä¾‹ã®ã‚ˆã†ã«ã€`toString()`ã‚’å®Ÿè£…ã—ãŸå ´åˆã¯ã€å®Ÿè£…ã•ã‚ŒãŸãƒ¡ã‚½ãƒƒãƒ‰ãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚

`toString`ãƒ¡ã‚½ãƒƒãƒ‰ä»¥å¤–ã«ã‚‚ã€`toPrimitive`ã®æ¤œè¨¼ã¨åŒã˜ãã€`Symbol.toStringTag`ã¨ã®[ã‚·ãƒ³ãƒœãƒ«](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Symbol/toStringTag)ãŒå­˜åœ¨ã—ã¾ã™ã€‚

```js
const myObj = {
  get [Symbol.toStringTag]():{
    return `myObj value: ${this.val}`
  },
  val: 100
}

myObj.toString() // '[object myObj value: 100]'
```

ã“ã“ã§ã®å„ªå…ˆé †ä½ã‚’ã¯ã£ãã‚Šã¨ã—ã¾ã—ã‚‡ã†ã€‚ã‚‚ã—ã¨ã‚ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®`toString`ãƒ¡ã‚½ãƒƒãƒ‰ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹å ´åˆã€ã“ã®`toString`ãŒæœ€å„ªå…ˆã§å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚`toString`ã¯å®Ÿè£…ã•ã‚Œã¦ã„ãªã„å ´åˆã€ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ãƒã‚§ã‚¤ãƒ³ã‚’é¡ã‚‹ã“ã¨ã¨ãªã‚‹ãŸã‚ã€çµæœçš„ã«`Object.prototype.toString()`ãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚`Symbol.toStringTag`ãŒå­˜åœ¨ã™ã‚‹å ´åˆã€`[object ${value of toStringTag}]`ã®å½¢ã§å‡ºåŠ›ã—ã¾ã™ã€‚ã‚‚ã—`Symbol.toStringTag`ãŒå­˜åœ¨ã—ãªã„å ´åˆã€`[object Object]`ã¨ã„ã†ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå½¢å¼ã§å‡ºåŠ›ã™ã‚‹ã®ã§ã€è¬ã®ãƒ€ãƒ–ãƒ«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ãªã‚‹ã®ã§ã™ã€‚

ã“ã®`toStringTag`ã®å€¤ã«ã¤ã„ã¦ã€JSå†…è”µã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚¿ã‚¤ãƒ—ã¯ãã‚Œãã‚Œã®ã‚¿ã‚¤ãƒ—åã¨ãªã£ã¦ã„ã¾ã™ã€‚ã¤ã¾ã‚Šã€

| å…ƒã‚¿ã‚¤ãƒ—  | å‡ºåŠ›å†…å®¹             |
| --------- | -------------------- |
| Null      | `[object Null]`      |
| Undefined | `[object Undefined]` |
| Array     | `[object Array]`     |
| Function  | `[object Function]`  |
| Date      | `[object Date]`      |
| RegExp    | `[object RegExp]`    |
| Boolean   | `[object Boolean]`   |
| Number    | `[object Number]`    |
| String    | `[object String]`    |

æ³¨æ„ã—ãŸã„ã®ã¯ã€ã“ã“ã®`Boolean`, `Number`, `String`ã¯åŸºæœ¬ã‚¿ã‚¤ãƒ—ã§ã¯ãªãã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ©ãƒƒãƒ‘ãƒ¼(`new String('123')`ã¨ã‹)ã¨ãªã£ã¦ã„ã¾ã™ã€‚ã“ã‚Œã‚‰ã¯ã‚¿ã‚¤ãƒ—çš„ã«**ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ**ã«ãªã‚Šã¾ã™ã€‚

**23/04/23è¿½è¨˜**

ã“ã®`toStringTag`ã®å€¤ã«å®Ÿã¯**ã‚¿ã‚¤ãƒ—ãƒã‚§ãƒƒã‚¯ã§ã‹ãªã‚Šæœ‰ç”¨**ã€`typeof`ã€`instanceof`ã‚ˆã‚Šã‚‚ã€å‹æ‰‹ã«ã“ã®å€¤è‡ªä½“ã‚’ä¸Šè¨˜ã®ã‚ˆã†ã«ç·¨é›†ã—ãªã„é™ã‚Šã€primitive/objectã®ã‚¿ã‚¤ãƒ—ã‚’å…¨éƒ¨ã‚«ãƒãƒ¼ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã€‚[ã“ã¡ã‚‰ã®è¨˜äº‹](https://www.zhenghao.io/posts/js-data-type)ã«ã‚‚å‚è€ƒã€‚

```js
function getType(value) {
  return Object.prototype.toString.call(value)
    .replace(/^\[object (\S+)\]$/, '$1')
    .toLowerCase();
}
```

### `==`ã¨`===`ã®é•ã„ã¯ï¼Ÿ

ã‚¿ã‚¤ãƒ—ã®å¼·åˆ¶å¤‰æ›ãŒæœ€ã‚‚ã‚ˆãè¦‹ã‚‰ã‚Œã‚‹ã¨ã“ã‚ã¨ã‚‚è¨€ãˆã‚ˆã†ã€‚ã€Œã¨ã«ã‹ã`==`ã¯ã‚„ã‚ã‚ã€ã¨è¨€ã‚ã‚ŒãŸã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã‹ã€‚

ãã®é•ã„ã¯ä¸€è¨€è¨€ãˆã°ã€å¼·åˆ¶å¤‰æ›ã®æœ‰ç„¡ã ã‘ã§ã™ã€‚`==`ã¯[`IsLooselyEqual`ã®æ“ä½œ](https://262.ecma-international.org/13.0/#sec-islooselyequal)ã‚’æ„å‘³ã—ã¦ãŠã‚Šã€`===`ã®æ–¹ã¯[`IsStrictlyEqual`](https://262.ecma-international.org/13.0/#sec-isstrictlyequal)ã¨ãªã‚Šã¾ã™ã€‚

å¤§åŸå‰‡ã¨ã—ã¦ã€
- æ¯”è¼ƒå¯¾è±¡ã®ã‚¿ã‚¤ãƒ—ãŒä¸€è‡´ã™ã‚Œã°ã€`IsLooselyEqual`ã¯`IsStrictlyEqual`ã¨åŒã˜æŒ™å‹•ã¨ãªã‚‹
- æ¯”è¼ƒå¯¾è±¡ã®ã‚¿ã‚¤ãƒ—ãŒä¸€è‡´ã—ãªã„å ´åˆã€**`number`ã‚’å„ªå…ˆãƒ’ãƒ³ãƒˆ**ã¨ã—ã¦ã€**ã‚¿ã‚¤ãƒ—ãŒä¸€è‡´ã™ã‚‹ã¾ã§å¼·åˆ¶å¤‰æ›ã—ç¶šã‘ã‚‹**

ã‚¹ãƒšãƒƒã‚¯ã§ç¤ºã•ã‚Œã¦ã„ã‚‹`Loosely`ã®å ´åˆã®å†…å®¹ã‚’æŠœç²‹ã™ã‚‹ã¨ã€æ¯”è¼ƒã™ã‚‹äºŒã¤ã®å€¤ã«ã¨ã£ã¦ã€

1. ã‚¿ã‚¤ãƒ—ä¸€è‡´ã®å ´åˆã¯ã€`IsStrictlyEqual`ã‚’å®Ÿè¡Œ
2. `null`ã¨`undefined`ã®å ´åˆã¯`true`
3. `number`ã¨`string`ã‚’æ¯”è¼ƒã™ã‚‹å ´åˆã€`string`ã‚’`ToNumber`ã§å¤‰æ›ã—ã¦ã‹ã‚‰æ¯”è¼ƒ
4. `boolean`ãŒå…¥ã£ã¦ã„ã‚‹å ´åˆã€`boolean`ã‚’`ToNumber`ã§å¤‰æ›ã—ã¦ã‹ã‚‰æ¯”è¼ƒï¼ˆã¤ã¾ã‚Š`1`ã‹`0`ã¨ãªã‚‹ï¼‰
5. ä¸€ã¤ã®å€¤ãŒã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚¿ã‚¤ãƒ—ã€ã‚‚ã†ä¸€ã¤ãŒåŸºæœ¬ã‚¿ã‚¤ãƒ—ã®å ´åˆã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚¿ã‚¤ãƒ—ã‚’`ToPrimitive`ã§åŸºæœ¬ã‚¿ã‚¤ãƒ—ã«å¤‰æ›ã—ã¦ã‹ã‚‰æ¯”è¼ƒ

ä¾‹ãˆã°ï¼š

```js
100 == '100' // true rule no.3
null == undefined // true rule no.2
'yes' == true // rule no.3 & no.4 =>  thus NaN == 1 is false
[] == false // rule no.4 & no.5 => valueOf returns [], calling toString, thus [] coerced to '', then to 0, 0 == 0 is true
[] == '0' // rule no.5 => when [] coerced to '', '' == '0' is false (same type already)
NaN == {} // rule no.5 => valueOf returns {}, thus calling toString, thus NaN == '[object Object]' is false
[] == [] // false emm..??
[] == ![] // true WTF?????
```

æœ€å¾Œã®äºŒã¤ã¯ç¢ºã‹ã«ãŠã‹ã—ã™ãã‚‹ã€‚

`[] == []`ã“ã‚Œã«é–¢ã—ã¦ã¯ã€ã“ã®æ–‡è„ˆã§ã¯ã‹ãªã‚Šç´›ã‚‰ã‚ã—ã„ã®ã§ã™ãŒã€ã™ã§ã«åŒã˜ã‚¿ã‚¤ãƒ—ãªã®ã§ã€ã‚¿ã‚¤ãƒ—ã®å¼·åˆ¶å¤‰æ›ã¯è¡Œã‚ã‚Œã¾ã›ã‚“ã€‚å˜ç´”ã«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚¿ã‚¤ãƒ—ã®ãƒ‡ãƒ¼ã‚¿ã¯ãƒ¬ãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ãªã®ã§ã€ãã‚Œãã‚Œã®`[]`ã¯ãƒ¡ãƒ¢ãƒªãƒ¼ãªã„ã®é•ã†ã¨ã“ã‚ã«ä¿å­˜ã•ã‚Œã¦ã„ã‚‹ã‹ã‚‰ã§ã™ã€‚`IsStrictlyEqual`ã®æŒ™å‹•ã¨åŒã˜ãã€`===`ã®çµæœã¨ä¸€è‡´ã—ã¾ã™ã€‚

ãã‚Œã§æœ€å¾Œã®ã‚‚ã®ã‚’è¦‹ã¦ã¿ã‚ˆã†ã€‚`!`ã¨`!!`ã¯ãƒ–ãƒ¼ãƒ«ã‚¿ã‚¤ãƒ—å¤‰æ›ã™ã‚‹æ¼”ç®—ãªã®ã§ã€ã“ã‚Œã¯æ¯”è¼ƒã‚ˆã‚Šå„ªå…ˆé †ä½ãŒé«˜ã„ã®ã§ã€å…ˆã«`![]`è¦‹ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚`ToBoolean`ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’å‚ç…§ã™ã‚‹ã¨ã€`[]`ãŒé…åˆ—ï¼Objectã‚¿ã‚¤ãƒ—ãªã®ã§ã€`true`ã¨ãªã‚Šã¾ã™ã€‚`!`ã¯å¦å®šã¨ãªã‚‹ã®ã§ã€å³å´ã®`![]`ã¯`false`ã¨ãªã‚Šã¾ã™ã€‚å·¦å´ã®`[]`ã¯ã™ã§ã«èª¬æ˜ã—ãŸé€šã‚Šã€`''`â†’`0`ã®ãƒ«ãƒ¼ãƒˆã§æ•°å­—ã®`0`ã¨ãªã‚Šã¾ã™ã€‚ã™ã‚‹ã¨ã€å³å´ã®`false`ãŒ`0`ã¨å¤‰æ›ã•ã‚Œã€ã“ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ã‚¿ã‚¤ãƒ—ä¸€è‡´ã—ã¦çµæœãŒ`true`ã¨åˆ¤æ–­ã€‚

### `== true`ã¯çµ¶å¯¾é¿ã‘ãŸã„

ã“ã‚Œã¾ã§è¦‹ãŸã‚‰ã€ã™ã§ã«ã‚ã‹ã‚‹ã¨æ€ã„ã¾ã™ãŒã€ã‚„ã¯ã‚Šè¦‹éã”ã—ã‚„ã™ã„ã®ã§å¼·èª¿ã—ãŸã„ã¨ã“ã‚ã§ã™ã€‚

ã‚³ãƒ¼ãƒ‰ã§ã¯ã‚ã¾ã‚Šã“ã®æ›¸ãæ–¹ã‚’ã™ã‚‹äººãŒã„ãªã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ï¼š

```js
if (res == true) {
  //...
}
```

ãã‚Œã§ã€ä»®ã«`res`ãŒãªãœã‹æ–‡å­—åˆ—ã«ãªã£ãŸã‚‰ï¼š

```js
'true' == true // false 'true' coerced to number, thus NaN == 1 is false
```

ã‚‚ã¡ã‚ã‚“ã€å…ˆã»ã©ã®`[]`ã‚‚ã‚ã‚Šã†ã‚‹ï¼š

```js
const res = []
if (res == false) { // [] coerced to '', then 0, thus 0 == 0 is true
  //...
}
```

ãªã®ã§ã€çµ¶å¯¾ã«`==true/false`ã¯æ›¸ã‹ãªã„ã§ãã ã•ã„ã€‚

ã‚€ã—ã‚ã€`if (res)`ã®æ–¹ãŒã ã„ã¶ãƒã‚·ã ã¨æ€ã„ã¾ã™ã€‚ifæ–‡ã¯ãƒ–ãƒ¼ãƒ«ã‚¿ã‚¤ãƒ—ã‚’å¿…è¦ã¨ã™ã‚‹ãŸã‚ã€ã‚«ãƒƒã‚³ã®ä¸­èº«ã¯å¿…ãš`ToBoolean`ã®æ“ä½œãŒè¡Œã‚ã‚Œã¾ã™ã€‚`ToBoolean`ã¯ä¸Šè¨˜ã®ãƒ•ã‚©ãƒ«ã‚·ãƒ¼å€¤ä»¥å¤–å…¨éƒ¨`true`ãªã®ã§ã€é–“é•ã„ã—ã«ãã„ã‚„ã‚Šæ–¹ã‹ã¨ã€‚

**23/04/23 è¿½è¨˜**

`NaN === NaN`ã®çµæœã¯`true`ã§ã¯ãªãã€`false`ã¨ãªã£ã¦ã„ã¾ã™ã€‚ã“ã‚Œã¯ã‚¿ã‚¤ãƒ—å¼·åˆ¶å¤‰æ›ã¨é–¢ä¿‚ã›ãšï¼ˆã™ã§ã«primitiveã®`number`ãªã®ã§ï¼‰ã€å˜ç´”ã«`NaN`è‡ªèº«ã®å®šç¾©ã«ã‚ˆã‚‹ã‚‚ã®ã§ã™ã€‚Not a numberã¯å®Ÿã¯ã‚¨ãƒ©ãƒ¼ã‚’æ„å‘³ã—ã¦ãŠã‚Šã€è‡ªåˆ†è‡ªèº«ã‚‚å«ã‚ã¦ã‚¤ã‚³ãƒ¼ãƒ«åˆ¤å®šã¯å…¨ã¦`false`ã¨ãªã‚Šã¾ã™ã€‚

ãã‚Œã§ã€`===`ã‚’ä½¿ãˆã°å¤§ä¸ˆå¤«ã€ã¨ã®ç”˜ã„è€ƒãˆã¯ã“ã“ã§å¹»æ»…ã—ã¾ã™ã€‚ã“ã®å•é¡Œã‚‚è§£æ±ºã™ã‚‹ãŸã‚ã«ã€`Object.is(a,b)`ã§åˆ¤å®šã™ã‚‹ã—ã‹ã‚ã‚Šã¾ã›ã‚“ã€‚ã“ã®ãƒ¡ã‚½ãƒƒãƒ‰ã¯ã€jså†…éƒ¨ã§2ã¤ã®å€¤ãŒå…¨ãä¸€ç·’ã‹ã©ã†ã‹ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã¨ãã«ä½¿ã†ã®ã§ã€å®Ÿã¯`===`ã‚ˆã‚Šã‚‚æ­£ç¢ºãªã®ã§ã™ã€‚`0 === -0`ã‚‚ä¼¼ãŸã‚ˆã†ãªã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ã¨ãªã‚Šã¾ã™ã€‚`NaN`ã¨ç¬¦å·ä»˜ãã®`0`ä»¥å¤–ã€`Object.is()`ã¯`===`ã¨åŒã˜ã¨ãªã‚Šã¾ã™ã€‚

è©³ç´°ã¯[ã“ã¡ã‚‰](https://javascript.info/number#tests-isfinite-and-isnan)ã«ã‚‚å‚è€ƒã€‚

### tsã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚­ãƒ¼ã®ã‚¿ã‚¤ãƒ—ã¯ãªãœ`string|number|symbol`ãªã®ã‹

ã“ã®ä¾‹ã¯[2.9ã®ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆ](https://www.typescriptlang.org/docs/handbook/release-notes/typescript-2-9.html#support-number-and-symbol-named-properties-with-keyof-and-mapped-types)ã«ã‚ã‚Šã¾ã™ã€‚

å˜åˆ€ç›´å…¥ã§ã„ã†ã¨ã€`symbol`ã¯åˆ¥æ‰±ã„ã¨ã—ã¦ã€ã‚­ãƒ¼ã¯æ•°å­—ã§å…¥ã‚Œã¦ã‚‚ã€æ–‡å­—åˆ—ã«å¼·åˆ¶å¤‰æ›ã•ã‚Œã‚‹ã‹ã‚‰ã§ã™ã€‚è©³ç´°ã¯[ã“ã¡ã‚‰ã®ã‚¹ãƒšãƒƒã‚¯](https://tc39.es/ecma262/#sec-object-type)ã«è¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚

> Properties are identified using key values. A property key value is either an ECMAScript String value or a Symbol value. All String and Symbol values, including the empty String, are valid as property keys. A property name is a property key that is a String value.
> An integer index is a String-valued property key that is a canonical numeric string and whose numeric value is either +0ğ”½ or a positive integral Number â‰¤ ğ”½(2^53 - 1). An array index is an integer index whose numeric value i is in the range +0ğ”½ â‰¤ i < ğ”½(2^32 - 1).

æ•°å­—ã‚’ä½¿ãŠã†ã¨ã€æœ€çµ‚çš„ã«æ–‡å­—åˆ—ã«å¤‰æ›ã™ã‚‹ã®ã§ã€é€šå¸¸tsã§ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å®šç¾©ã™ã‚‹ã¨ãã«ã€`Record<string,any>`ã¨ã‹ã€`[key:string]:any`ã¨ã‹ã®å½¢ã«ã™ã‚‹ã®ãŒå¤šã„ã§ã™ã€‚

ã“ã®å¤‰æ›ã‚’ä¾‹ã§è¦‹ã‚‹ã¨ï¼š

```js
const myObj = {}
myObj[true] = 111
myObj[undefined] = 222
myObj[{a:1}] = 333
myObj[[]] = 444
console.log(myObj) // { "true": 111, "undefined": 222, "[object Object]": 333, "": 444 }
```

## çµ‚ã‚ã‚Šã«

JSã®ã‚¿ã‚¤ãƒ—å¼·åˆ¶å¤‰æ›ã¯ã€ã“ã®è¨€èªã‚’ç†è§£ã™ã‚‹ãŸã‚ã«ä¸å¯æ¬ ãªéƒ¨åˆ†ã¨ãªã‚Šã¾ã™ã€‚ä»Šå›ã¯ãã®ä»•æ§˜ã«ã¤ã„ã¦ã€ä¾‹ã‚’è¦‹ãªãŒã‚‰æ¤œè¨¼ãƒ»ã¾ã¨ã‚ã¦ã¿ã¾ã—ãŸã€‚

å†’é ­ã«ã‚‚è§¦ã‚Œã¾ã—ãŸãŒã€ã‚¿ã‚¤ãƒ—ã®å¼·åˆ¶å¤‰æ›ã¯é¡•åœ¨çš„ã‹æš—é»™çš„ã‹ã¯çµŒé¨“ã«ã‚ˆã£ã¦å¤šå°‘ä¸»è¦³çš„ãªå•é¡Œã«ãªã‚Šãã†ã§ã™ãŒã€*ãã“*ã«ã‚ã¾ã‚Šæ°—ã«ã›ãšã€ã‚„ã¯ã‚Šé‡è¦ãªã®ã¯ã©ã“ã§å¤‰æ›ãŒè¡Œã‚ã‚Œã‚‹ã‹ã€ãã®å¤‰æ›ã®ãƒ«ãƒ¼ãƒ«ã¸ã®ç†è§£ã ã¨æ€ã„ã¾ã™ã€‚*ãã“*ã‚’æŠ¼ã•ãˆã¦ãŠã‘ã°ã€ã»ã¨ã‚“ã©ã®ã€Œã‚µãƒ—ãƒ©ã‚¤ã‚ºã€ã‚’é¿ã‘ã‚‰ã‚Œã‚‹ã§ã—ã‚‡ã†

æœ€å¾Œã¯ä¸€ç·’ã«å†’é ­ã®å•é¡Œè§£ç­”ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```js
console.log(!!'false') // ToBoolean on string, not empty string, thus true
console.log('3' - 1) // hint is number, thus 3 - 1 = 2
console.log(1 + '') // hint is default(number), but coerced to string, thus '1'
console.log( +{} ) // hint is number, valueOf returns {}, thus call toString and returns '[object Object]', coerced to NaN 
console.log( +[] ) // hint is number, valueOf returns [], thus call toString and returns '', coerced to 0
console.log([[]] + 1) // hint is default(number), valueOf returns [[]], toString returns '', '' + 1, hint is string, coerced 1 to string '1'
console.log([{}] + 1) // hint is default(number), valueOf returns [{}], toString returns '[object Object]', '[object Object]' + 1 coerced 1 to string, thus becomes to '[object Object]1'
console.log([] + {}) // hint is default(number), [] => '', {} => '[object Object]', results in '[object Object]'
console.log({} + {}) // hint is default(number), {} => '[object Object]', results in '[object Object][object Object]'
console.log({} - {}) // - can only operate on numbers, hint is number, {} => NaN, NaN - NaN = NaN,  
```
è£œè¶³ï¼š`[[[1]]] + 1`ã¨ã‹è¦‹ã‹ã‘ãŸã‚Šã—ã¾ã™ãŒã€é…åˆ—ã®`toString`ã‚’å‘¼ã³å‡ºã™æ™‚ã«`join`ãŒè¡Œã‚ã‚Œã¦ã€`[[1]]`ãŒå–ã‚Šå‡ºã•ã‚Œã¦ã€ã•ã‚‰ã«`toString -> join`ã®é€£ç¶šãªã®ã§ã€æœ€çµ‚çš„ã«`'1'`ã ã‘ã¨ãªã‚Šã¾ã™ã€‚ãªã®ã§ä½•é‡ã®`[]`ãŒã‚ã£ã¦ã‚‚åŒã˜ã§ã™ã€‚

ã§ã¯ã§ã¯ã€‚

ï¼ˆä¸Šè¨˜ã®å†…å®¹ã«ã¤ã„ã¦ä½•ã‹é–“é•ã„ã‚„å•é¡Œç‚¹ãªã©ãŒã‚ã‚Šã¾ã—ãŸã‚‰ã€ã”æŒ‡æ‘˜ã‚„ã‚³ãƒ¡ãƒ³ãƒˆã‚’ã„ãŸã ã‘ã‚‹ã¨å¤§å¤‰å¬‰ã—ãå­˜ã˜ã¾ã™ï¼‰