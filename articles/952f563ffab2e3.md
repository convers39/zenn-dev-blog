---
title: "Laravel Windowsç’°å¢ƒã§Supervisorã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—"
emoji: "ğŸ¥³"
type: "tech"
topics:
  - "laravel"
  - "windows"
  - "supervisor"
published: true
published_at: "2021-11-10 22:52"
---

[ã“ã¡ã‚‰ã®è¨˜äº‹](https://zenn.dev/convers39/articles/7eee3d89337a8a)ã¨é–¢ä¿‚ã—ã¦ã„ã¦ã€Windowsç’°å¢ƒã§ãƒ¯ãƒ¼ã‚«ãƒ¼ã‚’å®Ÿè¡Œã™ã‚‹æ–¹æ³•ã®ä¸€ã¤ã¨ãªã‚Šã¾ã™ãŒã€Supervisorã‚’Windowsã§ã‚‚ä½¿ã†æ–¹æ³•ã®ã¾ã¨ã‚ã¨ãªã‚Šã¾ã™ã€‚

### Supervisorã¨ã¯

[Laravelå…¬å¼](https://laravel.com/docs/8.x/queues#supervisor-configuration)ã§ã‚‚å‹§ã‚ã‚‰ã‚Œã¦ã„ã‚‹ãƒ¯ãƒ¼ã‚«ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹ç®¡ç†ã®ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚ã‚‚ã¡ã‚ã‚“ã€Laravelã«é™ã‚‰ãšã€ä½¿ç”¨ã™ã‚‹å ´é¢ãŒåºƒãã‚ã‚Šã¾ã™ï¼ˆ[doc](http://supervisord.org/)ï¼‰ã€‚æ ¹æœ¬çš„ã«ã€ãƒ—ãƒ­ã‚»ã‚¹ç®¡ç†ãƒ»ãƒ¢ãƒ‹ã‚¿ãƒ¼ãƒªãƒ³ã‚°ã®ãƒ„ãƒ¼ãƒ«ã¨ãªã‚Šã¾ã™ã€‚

ã“ã‚Œã‚’å€Ÿã‚Šã¦ä½•ã‚’ã™ã‚‹ã‹ã¨ã„ã†ã¨ã€Laravelã®ã‚¿ã‚¹ã‚¯ã‚­ãƒ¥ãƒ¼ã‹ã‚‰ã‚¸ãƒ§ãƒ–ã‚’æ¶ˆè²»ã™ã‚‹**ãƒ¯ãƒ¼ã‚«ãƒ¼**ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’èµ°ã‚‰ã›ã‚‹ã“ã¨ã§ã™ã€‚ã—ã‹ã‚‚ã€åŒæ™‚ã«è¤‡æ•°ã®ãƒ¯ãƒ¼ã‚«ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹ã‚’èµ·å‹•ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã¨ãªã‚Šã€windowsè‡ªèº«ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼ã‚ˆã‚Šä½¿ã„å‹æ‰‹ãŒè‰¯ã„ã§ã™ã€‚

ãŸã ã€æœ¬æ¥Unix-likeã®OSå‘ã‘ã®ãƒ„ãƒ¼ãƒ«ãªã®ã§ã€Windowsã§ä½¿ç”¨ã™ã‚‹ã«ã¯å…¬å¼ã§ã¯ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ä»Šå›ã¯ãã®æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

### ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

ã¾ãšã¯Pythonã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚[å…¬å¼ã‚µã‚¤ãƒˆ](https://www.python.org/)ã‹ã‚‰ã§å¤§ä¸ˆå¤«ã§ã™ã€‚

æ¬¡ã«ã€[git bash](https://gitforwindows.org/)ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚ã“ã“ã¯å¿…é ˆã§ã¯ãªã„ã®ã§ã‚¹ã‚­ãƒƒãƒ—ã§ã‚‚æ§‹ã„ã¾ã›ã‚“ã€‚ã‚³ãƒãƒ³ãƒ‰ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã¯è©¦ã—ã¦ã„ã¾ã›ã‚“ã®ã§ä»Šå›ã¯powershellã‹git bashã§ã®å‰æã¨ãªã‚Šã¾ã™ã€‚

ä»¥ä¸ŠãŒçµ‚ã‚ã£ãŸã‚‰ã€bashã§æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã§supervisordã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

```bash
pip install supervisor-win
```

ã“ã‚Œã§ä¸€æ—¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒå®Œäº†ã—ã¾ã—ãŸã€‚

### è¨­å®š

ã“ã®ã¾ã¾ã§bash/powershellã§`supervisord`ã§å®Ÿè¡Œã—ã¦ã‚‚ã€ã‚³ãƒ³ãƒ•ã‚£ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ãŒãªã„ã¨ã®ã‚¨ãƒ©ãƒ¼ãŒå‡ºã¦ãã¾ã™ã€‚

```bash
Error: No config file found at default paths (C:\Python39\etc\supervisord.conf, C:\Python39\supervisord.conf, supervisord.conf, etc/supervisord.conf, /etc/supervisord.conf, /etc/supervisor/supervisord.conf); use the -c option to specify a config file at a different path
```

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®å ´æ‰€ã«ã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚ãƒ’ãƒ³ãƒˆã®é€šã‚Šã€-cãƒ•ãƒ©ã‚°ã§ã‚³ãƒ³ãƒ•ã‚£ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã§ãã¾ã™ã€‚ã“ã“ã¯ä¾‹ã¨ã—ã¦ã€`C:\Python39\etc\supervisord.conf`ã«ã‚³ãƒ³ãƒ•ã‚£ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œã‚Šã¾ã™ã€‚

```bash
cd /c/Python39/etc
echo_supervisord_conf > supervisord.conf
```

ã“ã‚Œã§ã‚µãƒ³ãƒ—ãƒ«ã®ã‚³ãƒ³ãƒ•ã‚£ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ãŒä½œã‚‰ã‚Œã¾ã™ã€‚æ¬¡ã«Laravelã®è¨­å®šã‚’è¿½åŠ ã—ã¾ã™ã€‚

```bash
vim supervisord.conf
```
```conf
[program:laravel-worker]
process_name=%(program_name)s_%(process_num)02d
command=php.exe C:\\Users\\<username>\\path\\to\\app\\artisan queue:work --tries=3 --timeout=30
autostart=true
autorestart=true
user=apache
numprocs=4
startsecs=0
redirect_stderr=true
stdout_logfile=C:\\Users\\<username>\\path\\to\\app\\storage\\logs\\worker.log
```

commandã®éƒ¨åˆ†ã¯åŸºæœ¬çš„ã«`php artisan queue:work`ã‚’å®Ÿè¡Œã—ã¦ã„ã‚‹ã®ã§ã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãªã©ã®è¿½åŠ ã¯è‡ªç”±ã§ã™ã€‚numprocsã§ãƒ¯ãƒ¼ã‚«ãƒ¼ã®æ•°ãŒæ±ºã‚ã‚‰ã‚Œã¾ã™ã€‚stdout_logfileã§ãƒ¯ãƒ¼ã‚«ãƒ¼ã®ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¿å­˜å…ˆã‚’æ±ºã‚ã¾ã™ãŒã€åŸºæœ¬çš„ã«ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ­ã‚°ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã«ã™ã‚Œã°è‰¯ã„ã§ã—ã‚‡ã†ã€‚

ãŸã ã€ã“ã‚Œã ã‘ã§ã¯ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã¾ã™ã€‚ç†ç”±ã¯[supervisor]ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®è¨­å®šã«ã€ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜ã®ãƒ‘ã‚¹ã¯Linuxå‘ã‘ã®è¨­å®šã«ãªã£ã¦ã„ãŸã‹ã‚‰ã§ã™ã€‚æ¬¡ã®ã‚ˆã†ã«ã€`logfile`ã¨`pidfile`ã®ä¿å­˜ãƒ‘ã‚¹ã‚’ä¿®æ­£ã—ã¾ã™ã€‚

```conf
[supervisord]
logfile=C:\\Python39\\etc\\supervisord.logã€€; (main log file;default $CWD/supervisord.log)
logfile_maxbytes=50MB               ; (max main logfile bytes b4 rotation;default 50MB)
logfile_backups=10                  ; (num of main logfile rotation backups;default 10)
loglevel=info                       ; (log level;default info; others: debug,warn,trace)
pidfile=C:\\Python39\\etc\\supervisord.pid ; (supervisord pidfile;default supervisord.pid)
nodaemon=false                      ; (start in foreground if true;default false)
silent=false                 ; no logs to stdout if true; default false
minfds=1024                         ; (min. avail startup file descriptors;default 1024)
minprocs=200                        ; (min. avail process descriptors;default 200)
```

ã¯ã„ã€ã“ã‚Œã§ã‚³ãƒ³ãƒ•ã‚£ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜ã—ã¦ã€æº–å‚™ã¯ã§ãã¾ã—ãŸã€‚

è©¦ã—ã«bash/powshellã§å®Ÿè¡Œã—ã¦ã¿ã¾ã™ã€‚

```bash
supervisord -c C:\Python39\etc\supervisord.conf
```

èµ·å‹•ã•ã‚Œã¦ã„ã‚‹ã‹ã©ã†ã‹ãŒä¸å®‰ãªã‚‰ã€supervisordã®ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ã„ã¦ã¿ã¦ã€ãƒ¯ãƒ¼ã‚«ãƒ¼ã®å®Ÿè¡ŒçŠ¶æ³ãŒã‚ã‹ã‚Šã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/34cf957fa5f54719cd73ea80.png)

### çµ‚ã‚ã‚Šã«

Windowsã§Supervisorã‚’ä½¿ã†ã“ã¨ãŒç„¡ç†ã ã¨ã“ã®å‰æ€ã£ã¦ã„ã¾ã—ãŸã€‚æœ€è¿‘ã®æ¥­å‹™ã§ã€è¤‡æ•°ã®å‡¦ç†ã§æ™‚é–“ãŒçµæ§‹ã‹ã‹ã‚‹ã¨ã®å•é¡ŒãŒã‚ã‚Šã¾ã—ãŸãŒã€ãã‚Œã§è¤‡æ•°ã®ãƒ¯ãƒ¼ã‚«ãƒ¼ã§ä¸¦è¡Œå‡¦ç†ã—ã¦ã€å‡¦ç†æ™‚é–“ã‚’çŸ­ç¸®ã™ã‚‹ã¨ã„ã†æ–¹æ³•ã«ã—ã¾ã—ãŸã€‚ãŸã ã€windowsã®ã‚¿ã‚¹ã‚¯ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ãƒ¼ã§è©¦ã—ã¦ã¿ã¾ã—ãŸãŒã€ã©ã†ã‚‚è¤‡æ•°ã®ãƒ¯ãƒ¼ã‚«ãƒ¼ã®è¨­å®šãŒã†ã¾ãã„ãã¾ã›ã‚“ã€‚æœ€çµ‚çš„ã«supervisorã‚’ãªã‚“ã¨ã‹ä½¿ã£ã¦ã¿ã‚ˆã†ã¨æ€ã„ã¾ã—ãŸãŒã€è¨­å®šã®ã¨ã“ã‚ã‚‚ã„ã£ã±ã„è½ã¨ã—ç©´ãŒã‚ã‚Šã€ãƒ¯ãƒ¼ã‚«ãƒ¼ãŒèµ·å‹•ã¨ãªã£ãŸç¬é–“æ¶™å‡ºãã†ã§ã—ãŸï¼ˆç¬‘ï¼‰ã€‚

ã¡ãªã¿ã«ã€windowsã‚µãƒ¼ãƒ“ã‚¹ã¨ã—ã¦supervisorã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã‚‰ã—ã„ã§ã™ãŒã€è©¦ã—ãŸã¨ã“ã‚ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒè¦‹ã¤ã‹ã‚‰ãªã„ã“ã¨ã§å¤±æ•—ã—ã¦ã„ã¾ã™ã€‚ã¾ãŸåŸå› ã¯è©³ã—ãèª¿ã¹ã¦ã„ã¾ã›ã‚“ãŒã€èª²é¡Œã¨ã—ã¦æ®‹ã£ã¦ã—ã¾ã„ã¾ã™ã€‚

```bash
python -m supervisor.services install -c C:\Python39\etc\supervisord.conf
// ã¾ãŸã¯
supervisor_service.exe install -c C:\Python39\etc\supervisord.conf
```

ã§ã¯ã§ã¯ã€‚